# 计算机网络概述

## 概述

> 定义

将地理上分散的、具有独立工作能力的多台计算机通过通信设备和通信线路连接起来，在配有相应的网络通信软件条件下，实现数据通信、资源共享的系统



应用层 （http、ftp、smtp、pop3）交换应用报文

传输层 （tcp、udp）进程到进程

网络层 （ip，负责路由+转发）端到端

数据链路层和局域网（交换机）



> 什么是Internet？

网络：节点+边

计算机网络：联网的计算机构成的系统

​	组成：

​		节点：

​			主机节点

​			数据交换节点（根据层级不同，可分为路由器、交换机等）

​		边：

​			接入链路：连接主机节点和数据交换节点

​			骨干链路：连接数据交换节点

互联网：

​	以tcp、ip协议为主的一簇协议来支撑工作的网络

​	 从服务的角度：分布式应用、通信基础设施



> 什么是协议？

支撑互联网工作的标准

协议的定义：对等层实体在通信过程当中应该遵守的规则的集合，包括了语法、语义和时序

协议的作用：定义了在两个或多个通信实体之间交换的报文格式和次序，以及在报文传输和接收或其他方面所采取的动作





> 网络边缘

网络边缘构成：主机、应用程序设备（客户端、服务器）

数据交换模式

- 客户端、服务器模式
- 对等（peer-peer）模式



网络边缘采用网络设置的**面向连接**服务



> 网络核心

分组交换 -- 资源共享

- 使用存储-转发模式

线路交换 -- 独享资源

- 时分
- 波分
- 频分



网络核心功能：

路由：决定分组采用的源到目标的路径

转发：将分组从路由器的输入链路转移到输出链路



> 接入网、物理媒介

接入网

- DSL
- 线缆网络



物理媒介

- 导引型媒体 -- 信号沿着固体媒介被导引（光纤、双绞线、同轴电缆）
- 非导引型媒体 -- 信号自由传播（无线电）



> Internet/ISP结构
>

ISP（Internet Service Provider）互联网服务提供商

ICP（Internet Content Provider，如：Google、Microsoft）互联网内容提供商

IXP（Internet Exchange Point），不同电信运营商之间为连通各自网络二建立的集中交换平台



> 性能：丢包、延时、吞吐量
>

分组丢失和延时的原因：

- 分组到达路由器的速率超过了链路输出的能力
- 分组等待队头被传输



四种分组延时

1. 处理延时
2. 排队延时
3. 传输延时
   - L（bit）：传输的bit数
   - R（bps）：链路带宽，表示单位时间传输bit数
   - L/R为传输延时
4. 传播延时



> 协议层次、服务模型
>

服务：底层实体向上层实体提供他们之间的通信的能力

服务访问点SAP（Services Access Point）：上层使用下层提供的服务通过层间的接口

原语：上层使用下层服务的形式



**Internet协议栈**

应用层：为人类或其他应用进程提供网络应用服务

传输层：进程到进程的区分、可靠数据传输

网络层：传输以分组为单位的端到端的数据

数据链路层：在相邻两点之间，传输以帧为单位的数据

物理层



**ISO/OSI参考模型**

应用层

表示层：允许应用解释传输的数据

会话层：数据交换的同步、检查点、恢复

传输层

网络层

链路层

物理层



**各个层次的协议数据单元**

应用层：报文（message）

传输层：报文段（segment）

网络层：分组（packet），无连接的方式：数据报（datagram）

数据链路层：帧（frame）

物理层：位（bit）

![](.\图片\tcp.png)



# 应用层

网络应用的体系结构：

客户端-服务器模式：CS架构

对等模式：P2P模式

混合体模式：CS+P2P



## 应用层协议原理

> 应用层协议需要解决的问题

1、标识进程

对进程进行编址，进程接收报文，需要一个标识SAP，SAP包括了：

- 主机IP
- 采用的传输层协议：TCP、UDP
- 端口号



2、传输层提供的服务--穿过层间的信息

层间接口必须携带的信息

- 报文
- 应用进程标识
- 对方的应用进程标识



传输层实体根据这些信息进行TCP、UDP报文段的封装

- 源端口号、目标端口号等
- 源IP、目标IP



3、如何使用传输层提供的服务实现应用

- 定义应用层协议
- 编制程序



> Socket

TCP Socket：

- TCP服务：两个进程之间通信之前要建立连接
- 可以用一个整数表示两个应用实体之间的通信关系，从而使得穿过层间的信息量减少
- TCP Socket：源IP、源端口、目标IP、目标端口



UDP Socket：

- UDP服务：两个进程之间通信无需建立连接
- UDP Socket：本IP、本端口





## Web和HTTP

> 术语
>

Web页：含有一个基本的html文件，该html文件还包含若干对象的引用，引用实现方式为url



> HTTP

HTTP：超文本传输协议

| HTTP方法 | 作用                             |
| -------- | -------------------------------- |
| POST     | 增 -- 向服务器提交数据           |
| DELETE   | 删 -- 删除服务器的某些资源       |
| PUT      | 改 -- 修改服务器数据             |
| GET      | 查 -- 对服务器资源获取的简单请求 |
| HEAD     | 请求页面的首部，获取资源的元信息 |



## Email

> 概述

电子邮件组成部分：

- 信封

- 内容（包含首部和主体）



邮件内容的首部包含一些首部行（关键字：内容）。

关键字：

- To：必需的关键字，后面填入一个或多个收件人的电子邮件地址。（电子邮件地址的规定格式为:收件人邮箱名@邮箱所在主机的域名）


- Subject：可选关键字，是邮件的主题，反映了邮件的主要内容


- From：关键字必填，但它通常由邮件系统自动填入




> 组成部分

3个主要组成部分：

- 客户代理
- 邮件服务器
- 简单邮件传输协议：SMTP



![在这里插入图片描述](https://img-blog.csdnimg.cn/cb37c947d41e44c5ba95c35a7a86c299.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUGFyYW5vaWTimIY=,size_20,color_FFFFFF,t_70,g_se,x_16)



> SMTP协议

SMTP规定在两个相互通信的SMTP进程之间应如何交换信息



传输的3个阶段：

1. 建立连接
2. 邮件传送
3. 释放连接



命令、响应交互模式：

- 命令：ASCII文本
- 响应：状态代码和语句



> POP3协议

POP（Post Office Protocol）

POP3协议时邮件访问协议，从服务器获取邮件



POP两种工作方式：

- 下载并保留
- 下载并删除



## DNS

> 主要目的

- 实现主机名-IP地址的转换

- 负载均衡



> 思路

- 分层、基于域的命名机制
- 在网络边缘处理复杂性



## CDN

全网部署缓存节点，存储服务内容，就近为用户提供服务



## Sokcet编程

### TCP套接字编程

TCP服务：提供可靠的、字节流的服务



### UDP套接字编程

提供不可靠的、UDP数据报服务





# 传输层



## 传输服务

目标：提供高效、可靠、成本有效的数据传输服务

传输实体的实现方式可以有多种：

- 操作系统内核
- 链接库（绑定到网络应用中）
- 独立的用户进程
- ...



### 传输服务原语

基本传输原语

- listen -- 阻塞直到某个进程发送连接请求
- connect -- 主动尝试建立连接
- send -- 发送信息
- receive -- 阻塞直到接收一个data包
- disconnect -- 请求释放连接



中断连接的方式

- 对称：一方执行disconnect，表示它当前无数据要发送，但仍接收对方发送的数据，直到对方发送disconnect请求才真正释放连接
- 非对称：任何一方发送disconnect原语，当该传输段到达对方时，连接就被释放了



## 传输协议要素

寻址



> 建立连接

建立连接需要解决网络可能出现的丢失、延迟、损坏和重复数据包的问题



解决方法：

设置数据包的生存期，使用以下一种或多种技术将生存期限定在一个最大值内：

1. 限制网络设计
2. 在每个数据包中放置跳计数器
3. 为每个时间包打上时间戳（需要同步所有路由器的时钟）









## 多路复用/解复用

> 多路复用

多路复用对应发送方

从多个套接字接收来自多个进程的报文，根据套接字对应的IP地址和端口号等信息对报文段头部加以封装



> 多路解复用

多路解复用对应接收方

根据报文段的头部信息中的IP地址和端口号将接收到的报文段发给对应的套接字和对应的应用进程



## UDP

UDP应用场景：

- 流媒体（速率敏感、丢失部敏感）
- DNS
- SNMP



> UDP校验和

目的：检测在被传输报文段中的差错



发送方：

将报文段的内容视为16bit的整数

校验和：报文段的加法和

发送方将校验和放在UDP校验和字段



接收方：

计算接收到的报文段的校验和

检查计算出的校验和与校验和字段的内容是否相等：

- 相等 -- 没有检测到差错，但可能有残存错误
- 不相等 -- 检测到错误





> 回卷校验和

当数字相加时，最高位的进位要回卷，再加到结果上

最后求出的和求反得到校验和



目标端：

校验范围+校验和=1111111111111111，则通过校验，否则没有通过校验







## 可靠传输原理

可靠数据传输：rdt

假设下层传输从可靠一步步到不可靠，如何解决每一步不可靠产生的问题

使用有限状态机（fsm）来描述状态变化过程



> rdt1.0

下层的信道完全可靠

- 无bit出错
- 无分组丢失



发送方和接收方FSM：

- 发送方将数据发送到下层信道
- 接收方从下层信道接收数据



> rdt2.0

下层信道可能会出错：将分组中的比特翻转

- 用校验和来检测bit差错



新机制：采用差错控制编码进行差错检测

- 发送方差错控制编码、缓存
- 接收方使用编码检错
- 接收方反馈：控制报文（ACK、NAK）发送给发送方
- 发送方收到反馈采取相应措施





> rdi2.1

如果ACK/NAK出错，发送方不知道接收方发生了什么事情，怎么办？

发送方如果重传，可能导致重复

不重传，可能死锁或出错



此时，引入新的机制：**==序号==**



处理重复：

- 发送方在每个分组中加入序号
- 如果ACK/NAK出错，发送方重传当前分组
- 接收方丢弃重复分组



停等协议：发送方发送一个分组，然后等待接收方的应答











