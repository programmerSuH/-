# 概述

## 基本概念

> 什么是操作系统

- 用户角度：OS是一个控制软件
- 资源管理角度：OS是资源分配器（管理外设、分配资源）



> 操作系统内核

操作系统组成可以分为Shell和kernel，kernel的作用在于对上层提供服务，而kernel是操作系统的核心部分

kernel-操作系统内核组件，包括：

- CPU调度器
- 物理内存管理
- 虚拟内存管理
- 文件系统管理
- 中断处理与设备驱动



操作系统内核特征：

- 并发管理
- 共享
  - 同时访问
  - 互斥共享
- 虚拟
  - 利用多道程序设计技术，让每个用户觉得有一个计算机专门为他服务
- 异步
  - 程序运行不是一贯到底，二是走走停停，向前推进的速度是不可预知的



> 操作系统的作用

1. 抽象计算机资源

2. 硬件访问和复用

   操作系统内核可以访问与修改硬件资源

3. 隔离性

4. 允许共享

5. 安全性，访问控制

6. 高性能

7. 多用途



## 启动

OS的代码初始放在磁盘中，如果想要启动OS，就需要在开机时存在一种调用，将OS代码从磁盘加载到内存中，使用的加载器就是bootloader

DISK：存放OS和bootloader

BIOS：基本I/O处理系统（在内存中）

- 将Bootloader从磁盘的引导扇区加载到内存中，如0x7c00
- 跳转到CS:IP=0000:7c00

Bootloader：加载OS

- 将操作系统的代码和数据从硬盘加载到内存中
- 跳转到操作系统的起始地址





## 系统调用、中断和异常

- 系统调用（来源于应用程序）
  - 应用程序主动向操作系统发出服务请求

- 中断（来源于外设：如键盘、鼠标、网卡、声卡等）

  - 来自不同硬件设备的计时器和网络的中断

- 异常（来源于不良的应用程序）

  - 非法指令或其他坏的处理状态

  

> 中断

硬件

- 设置中断标记 

软件

- 保存当前处理状态
- 中断服务程序处理
- 清除中断标记
- 恢复之前保存的处理状态



> 异常

- 保存现场
- 异常处理
  - 杀死异常程序
  - 重新执行异常指令
- 恢复现场







# 内存

操作系统管理内存的方法：

- 程序重定位
- 分段
- 分页
- 虚拟内存
- 按需分页虚拟内存



## 内存分配

### 动态分配策略

- 首次适配：每次将第一个适配的内存区域分配出去

- 最优适配：每次将最适配的内存区域分配出去

- 最差适配：每次将最不适配的内存区域分配出去





> 连续内存分配

- 压缩式碎片整理
- 交换式碎片整理





> 非连续内存分配

非连续内存分配方法：

- 分段

- 分页



**分段**

- 程序的分段地址空间
- 分段寻址方案



**分页**

-  划分物理内存至固定大小的帧
- 划分逻辑地址空间至相同大小的页
- 建立方案，转换逻辑地址为物理地址
  - 页表
  - MMU、TLB



> 分页机制性能问题

访问一次内存单元需要2次内存访问

- 一次访问页表
- 一次访问数据

页表可能非常大



解决方法

- 缓存
- 间接访问



TLB（Translation Look-aside Buffer）

- 缓存近期访问的页帧转换表项







## 虚拟内存

虚拟内存=物理内存+磁盘



**页表表项**

<img src="D:\Note\study_notes\操作系统\图片\页表表项.png" width=50% align=left>



驻留位：表示该页是在内存还是外存。驻留位为1，表示该页在内存中，页表项有效；该位为0，表示该页在外存中，访问该页表项会导致缺页中断

保护位：表示允许对该页做何种类型的访问，如只读、可读写、可执行等

修改位：表明此页在内存中是否被修改过，当系统回收该物理页时，根据修改位来决定是否需要将内容写回外存

访问位：表示该页面是否被访问过，用于页面置换算法







### 页面置换算法

> 最优页面置换算法

- 当一个缺页中断发生时，对于保存在内存中的每一个逻辑页面，计算它下次被访问之前需要等待的时间，选择时间最长的作为被置换的页面
- 但这只是一种理想情况，在实际系统中无法实现。可以作为其他算法性能的评价依据 



> 先进先出算法

先进先出算法（First In First Out, FIFO）

基本思路：选择在内存中驻留时间最长的页面替换。

具体实现：系统维护一个链表，记录了所有位于内存中的逻辑页面。从链表的排列顺序看，链表首页面驻留时间最长，当发生缺页中断时，把链表首页面替换，并把新页面添加到链表的末尾

劣势：性能较差，调出的页面可能是经常要访问的页面





> 最近最久未使用算法

最近最久未使用算法（Least Recently Used，LRU）

基本思路：发生缺页中断时，选择最久未使用的页面进行替换

依据：程序的局部性原理

实现方法：

1. 系统维护一个页面链表，最近使用的页面作为首节点，每次访问内存时，找到相应页面，将它从链表中取出，移动到链表之首。发生缺页中断时，淘汰链表末尾页面
2. 设置活动页面栈，每次访问某页面时，将页号压入栈顶，若栈内有相同页号的记录，就将其抽出。发生缺页中断时，总是选择栈底的页面进行替换





> 时钟页面置换算法

基本思路：

- 使用页表项中的访问位，当一个页面被加载到内存中时，把该位初始化为0，如果页面被访问，则将该位设为1
- 将各个页面组织成环形链表，把指针指向最老的页面（最先进来）
- 当发生缺页中断时，考察指针所指向的最老的页面，如果它的访问位为0，则淘汰该页；若访问位为1，则设为0，指针往下移动。如此下去，直到找到被淘汰的页面，然后指针移动到它的下一格





# 进程



## 概念

> 进程的定义

一个具有一定功能的程序在一个数据集合上的一次动态执行过程



> 进程的组成

一个进程包括：

- 程序代码
- 程序处理的数据
- 程序计数器
- 通用寄存器的值、堆、栈
- 一组系统资源



进程与程序的区别：

- 进程是动态的；程序是静态的
- 程序是有序代码的集合；进程是程序的执行





>  进程的特点

动态性：可动态创建、结束进程

并发性：进程可以被独立调度并占用处理机运行

独立性：不同进程工作互不影响

制约性：访问共享数据、资源或进程间同步产生制约





> 进程控制块

描述进程的数据结构：进程控制块（Process Control Block，PCB）

进程控制块：操作系统管理控制进程运行所用的信息集合（PCB是进程存在的唯一标志）





PCB含有三大类信息：

1. 进程标识信息：本进程的标识，父进程标识、用户标识

2. 处理及状态信息保存区

   - 用户可见寄存器
   - 控制和状态寄存器（程序计数器 PC，程序状态字）
   - 栈指针

3. 进程控制信息

   - 调度和状态信息

   - 进程间通信信息

   - 存储管理信息

   - 进程所用资源

     





## 进程管理

> 进程状态

- 进程的生命期管理
- 进程状态变化模型
- 进程挂起模型





> 进程状态变化模型

进程的三种基本状态：

- 运行状态
- 就绪状态
- 阻塞状态（等待状态）



进程其他基本状态

- 创建状态
- 结束状态 



> 进程挂起

进程在挂起状态时，意味着进程没有占用内存空间。处在挂起状态的进程映像在磁盘上



挂起状态：

- 阻塞挂起状态：进程在外村并等待某事件出现
- 就绪挂起状态：进程在外存，但只要进入内存就可以运行



挂起：把一个进程从内存转到外存

- 阻塞到阻塞挂起
- 就绪到就绪挂起
- 运行到就绪挂起



在外存时的状态转换

- 阻塞挂起到就绪挂起



与挂起相关的状态转换

- 就绪挂起到就绪
- 阻塞挂起到阻塞



> 状态队列

由操作系统来维护一组队列，用来表示系统当中所有进程的当前状态

不同的状态用不同的队列来表示（就绪队列、各种类型的阻塞队列）













































 
