/*! For license information please see c__LazyReview.8c74fb4e.async.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{3702:function(e,t,r){"use strict";r(3386);var n=r(2814);r(3378);t.a=n.a},4535:function(e,t,r){"use strict";r.r(t),r.d(t,"useViewModel",(function(){return ar}));r(3378);var n=r(3702),a=r(0),o=r.n(a),i=r(555),c=r(13),l=r.n(c),u=r(8),s=r.n(u),d=r(677),f=r(42),p=(r(64),r(21)),m=(r(61),r(23)),v=r(38),h=r(528),y=(r(113),r(35)),w=(r(94),r(27)),b=r(426),g=r(571),_=r(1667),E=r(3680);function S(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return C(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw o}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var N={formatUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Array.isArray(e)||(e=[e]);var t,r=S(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.user_id||(n.user_id=n.id)}}catch(e){r.e(e)}finally{r.f()}return e}},A=N,j=r(342),x=r(2688),O=r(3927),I=(r(95),r(49)),T=(r(122),r(74)),R=(r(227),r(112)),L=(r(445),r(166)),k=r(46),P=r.n(k),D=r(985),M=r(986),U={tip:"ProductCodeSelector-module_tip_St4dm",emptyTip:"ProductCodeSelector-module_emptyTip_lW7-X",img:"ProductCodeSelector-module_img_C8Xr5",loading:"ProductCodeSelector-module_loading_0OSLf",modalDesc:"ProductCodeSelector-module_modalDesc_XRZ9X",modal:"ProductCodeSelector-module_modal_d62HS",productCodeWrapper:"ProductCodeSelector-module_productCodeWrapper_vMvvU",productNameHeader:"ProductCodeSelector-module_productNameHeader_PCscR",productCode:"ProductCodeSelector-module_productCode_C2MU2",notExpandableProdName:"ProductCodeSelector-module_notExpandableProdName_FusC7",checkbox:"ProductCodeSelector-module_checkbox_bePsu",expandTrigger:"ProductCodeSelector-module_expandTrigger_x7Aha"};function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function W(e,t,r){return t=function(e){var t=function(e,t){if("object"!==F(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===F(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function G(e){return function(e){if(Array.isArray(e))return q(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||V(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(){B=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,a){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),c=new N(a||[]);return n(i,"_invoke",{value:_(e,r,c)}),i}function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d={};function f(){}function p(){}function m(){}var v={};l(v,o,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(A([])));y&&y!==t&&r.call(y,o)&&(v=y);var w=m.prototype=f.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function g(e,t){function a(n,o,i,c){var l=s(e[n],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==F(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,i,c)}),(function(e){a("throw",e,i,c)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return a("throw",e,i,c)}))}c(l.arg)}var o;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){a(e,r,t,n)}))}return o=o?o.then(n,n):n()}})}function _(e,t,r){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return j()}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var c=E(i,r);if(c){if(c===d)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=s(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var a=s(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,d;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:j}}function j(){return{value:void 0,done:!0}}return p.prototype=m,n(w,"constructor",{value:m,configurable:!0}),n(m,"constructor",{value:p,configurable:!0}),p.displayName=l(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},b(g.prototype),l(g.prototype,i,(function(){return this})),e.AsyncIterator=g,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new g(u(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},b(w),l(w,c,"Generator"),l(w,o,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=A,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function Y(e,t,r,n,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,a)}function z(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Y(o,n,a,i,c,"next",e)}function c(e){Y(o,n,a,i,c,"throw",e)}i(void 0)}))}}function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||V(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function V(e,t){if(e){if("string"==typeof e)return q(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?q(e,t):void 0}}function q(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Q=w.a.Search,X=function(e){var t=H(Object(a.useState)([]),2),r=t[0],n=t[1],o=H(Object(a.useState)(e.selectedCodes),2),i=o[0],c=o[1],l=H(Object(a.useState)(!0),2),u=l[0],s=l[1],d=H(Object(a.useState)(!0),2),f=d[0],p=d[1];Object(a.useEffect)((function(){var e=function(){var e=z(B().mark((function e(){var t;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(!0),e.next=3,v.a.mine.productCode();case 3:t=e.sent,n(t),s(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[]);var m=Object(a.useCallback)(P()(function(){var e=z(B().mark((function e(t){var r;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!1),s(!0),e.next=4,v.a.mine.productCode({query:t||window.appData.me.work_id||""});case 4:r=e.sent,n(r),s(!1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),800),[]);return{state:{productCodes:r,selectedCodes:i,codeLoading:u,isInitialLoad:f},onAddProductCode:function(){e.onAddProductCode(i)},handleSelectCode:function(e,t){var r,n;!!i.find((function(e){return e.productCode===t.data.productCode}))?(r=t,n=i.filter((function(e){return e.productCode!==r.data.productCode})),c(n)):function(e){if(!i.find((function(t){return t.productCode===e.data.productCode}))){var t=e.data.participantList.find((function(e){return"PRODUCT_PD_OWNER"===e.roleType}))||{},r={productName:e.data.productName,productCode:e.data.productCode,pdOwner:t.userName||""};c([].concat(G(i),[r]))}}(t)},handleChangeQuery:function(e){m(e.target.value)}}},J=function(e){var t=e.visible,r=X(e),n=r.state,a=n.selectedCodes,i=n.codeLoading,c=n.productCodes,u=n.isInitialLoad,s=a.length>0,d=o.a.createElement(o.a.Fragment,null,o.a.createElement(p.a,{onClick:e.onCancel},__("取消")),o.a.createElement(p.a,{type:"primary",disabled:!s,onClick:r.onAddProductCode},__("确定"))),f=[{title:o.a.createElement("span",{className:U.productNameHeader},__("产品名称")),dataIndex:["data","productName"],ellipsis:!0,width:272,render:function(e,t){var r=t.data.productCode,n=!!a.find((function(e){return e.productCode===r}));return o.a.createElement("span",{className:l()(W({},U.notExpandableProdName,!(t.children&&t.children.length>0)))},o.a.createElement(L.a,{checked:n,className:U.checkbox}),o.a.createElement("a",{target:"_blank",href:"https://pd.alipay.com/#/product/main?productCode=".concat(t.data.productCode),title:e,onClick:function(e){return e.preventDefault()}},e))}},{title:o.a.createElement("span",{className:U.productCode},__("产品码")),dataIndex:["data","productCode"],width:240,render:function(e){return o.a.createElement("span",{className:U.productCode},e)}},{title:__("产品负责人"),dataIndex:["data","participantList"],render:function(e){var t=e.find((function(e){return"PRODUCT_PD_OWNER"===e.roleType}));return t&&t.userName?o.a.createElement("span",null,t.userName):o.a.createElement("span",null,__("暂无"))}}];return o.a.createElement(I.a,{className:U.modal,title:__("可关联的产品码"),visible:t,footer:d,bodyStyle:{height:445,padding:0,marginBottom:"12px",borderBottom:"1px solid #e8e8e8"},width:666,onCancel:e.onCancel},o.a.createElement("p",{className:l()(U.tip,U.modalDesc)},o.a.createElement("span",null,__("请选择要关联的产品码，或去 {productCode} 申请",{productCode:o.a.createElement("a",{href:"https://pd.alipay.com/#/product/createProductProcess",target:"_blank"},__("产品星球"))})),o.a.createElement(y.a,{title:__("产品码是蚂蚁产品委员会发起的对支付宝产品资产进行盘点和梳理的唯一标识")},o.a.createElement(_.default,null))),o.a.createElement("p",{className:U.tip},o.a.createElement(Q,{onChange:r.handleChangeQuery,onSelectNone:r.handleChangeQuery,placeholder:__("搜索产品名称、产品码、产品负责人...")})),o.a.createElement("div",{className:U.productCodeWrapper},i&&o.a.createElement("div",{className:U.loading},o.a.createElement(R.a,null)),!i&&(c&&c.length>0?o.a.createElement(T.a,{className:U.list,columns:f,dataSource:c,defaultExpandAllRows:!0,expandIcon:function(e){if(e.expandable)return e.expanded?o.a.createElement("a",{className:U.expandTrigger,onClick:function(t){t.stopPropagation(),e.onExpand(e.record,t)}},o.a.createElement(D.default,{style:{fontSize:"12px",color:"#595959"}})):o.a.createElement("a",{className:U.expandTrigger,onClick:function(t){t.stopPropagation(),e.onExpand(e.record,t)}},o.a.createElement(M.default,{style:{fontSize:"12px",color:"#595959"}}))},indentSize:12,pagination:!1,rowKey:function(e){return e.data.productCode},onRow:function(e){return{onClick:function(t){return r.handleSelectCode(t,e)}}}}):o.a.createElement("div",{className:U.emptyTip},o.a.createElement("div",{className:U.img}),o.a.createElement("p",null,u?__("未搜索到与你相关的产品码，输入产品名搜索或去 {productCode} 添加",{productCode:o.a.createElement("a",{href:"https://pd.alipay.com/#/product/createProductProcess",target:"_blank"},__("产品星球"))}):__("未搜索到相关产品码, 到 {productCode} 申请",{productCode:o.a.createElement("a",{href:"https://pd.alipay.com/#/product/createProductProcess",target:"_blank"},__("产品星球"))}))))))};J.propTypes={visible:s.a.bool.isRequired,onCancel:s.a.func.isRequired,onAddProductCode:s.a.func.isRequired,selectedCodes:s.a.array};var Z=J,$="Info-module_wrapper_cDOM9",K="Info-module_block_sgefC",ee="Info-module_blockTitle_rk05N",te="Info-module_blockTitleInline_3topf",re="Info-module_required_S47QQ",ne="Info-module_placeholder_nQfZM",ae="Info-module_readonlyWrapper_ZRhQC",oe="Info-module_reviewerWrapper_ZiwCW",ie="Info-module_descText_JA99V",ce="Info-module_btnAddReviewer_dTAt1",le="Info-module_reviewerList_Rv+Px",ue="Info-module_reviewerItemLite_0uWgx",se="Info-module_reviewerStatusWrapper_WK9wG",de="Info-module_reviewerAvatarWrapper_rvpZE",fe="Info-module_rejectStatus_woOeh",pe="Info-module_acceptedStatus_TL1Yk",me="Info-module_incompleteStatus_hrNd+",ve="Info-module_reviewerAvatar_GEw0V",he="Info-module_reviewerName_BaP17",ye="Info-module_reviewerItem_E9bva",we="Info-module_reviewerNameAndAvatar_sezG8",be="Info-module_btnRemove_I2pQp",ge="Info-module_ccList_hEFdx",_e="Info-module_ccName_HOdjG",Ee="Info-module_descWrapper_NAdFl",Se="Info-module_descInput_4PIAQ",Ce="Info-module_miniWrapper_8qIhN",Ne="Info-module_approveBtn_uQusK",Ae="Info-module_tooltip_qcsZd",je="Info-module_link_xW9Ia",xe="Info-module_startTime_c9M9N",Oe="Info-module_ccSep_a03J-",Ie="Info-module_popoverWrapper_hPfWo",Te="Info-module_approveBtnWrapper_A8O-+",Re="Info-module_showMoreBtn_bg8HS",Le="Info-module_iconDown_NugP3",ke="Info-module_iconRight_RQeR5",Pe="Info-module_baiyanWrapper_BzQfy",De="Info-module_baiyanBtn_1qWwn",Me="Info-module_baiyanDesc_srRM5",Ue="Info-module_errorText_7iHpe",Fe="Info-module_tasksWrapper_KYjB8",We="Info-module_taskList_FphTn",Ge="Info-module_project_nxlTa",Be="Info-module_milestone_TZ6sD",Ye="Info-module_milestoneStatus_WYJXP",ze="Info-module_taskItem_ND7fO",He="Info-module_taskItemEditable_Gu3I-";function Ve(e){return Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(e)}function qe(e,t,r){return t=function(e){var t=function(e,t){if("object"!==Ve(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ve(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Ve(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qe(e){return function(e){if(Array.isArray(e))return Ze(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Je(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||Je(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Je(e,t){if(e){if("string"==typeof e)return Ze(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ze(e,t):void 0}}function Ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var $e=function(e){var t=e.review,r=e.editable,n=e.target,o=Xe(Object(a.useState)(t?A.formatUser(t.approvers):[]),2),i=o[0],c=o[1],l=Xe(Object(a.useState)(t?A.formatUser(t.ccs):[]),2),u=l[0],s=l[1],d=Xe(Object(a.useState)((null==t?void 0:t.product_codes)||[]),2),f=d[0],p=d[1],v=Xe(Object(a.useState)(t?t.name:(null==n?void 0:n.title)||__("文档评审")),2),h=v[0],y=v[1],w=Xe(Object(a.useState)(t?t.body:""),2),b=w[0],g=w[1],_=Xe(Object(a.useState)(!1),2),S=_[0],C=_[1],N=Xe(Object(a.useState)(!1),2),j=N[0],x=N[1],O=Xe(Object(a.useState)(!1),2),I=O[0],T=O[1],R=Xe(Object(a.useState)(!1),2),L=R[0],k=R[1],P=Xe(Object(a.useState)(),2),D=P[0],M=P[1],U=Xe(Object(a.useState)(),2),F=U[0],W=U[1],G=Xe(Object(a.useState)(),2),B=G[0],Y=G[1],z=Xe(Object(a.useState)(),2),H=z[0],V=z[1];return Object(a.useEffect)((function(){var t;t={},h||(t.name=__("评审名称不可为空")),(null==h?void 0:h.length)>22&&(t.name=__("评审名称最多不可超过 22 个字")),(null==b?void 0:b.length)>1e3&&(t.desc=__("评审描述最多不可超过 1000 个字")),(null==i?void 0:i.length)>20&&(t.approver=__("评审人数最多不可超过 20 人")),(null==u?void 0:u.length)>20&&(t.cc=__("抄送人数最多不可超过 20 人")),M(t.name),W(t.desc),Y(t.approver),V(t.cc),e.onError(t)}),[h,b,i,u,r]),Object(E.a)(r&&L,__("评审尚未保存，确定离开页面？")),{state:{approvers:i,ccs:u,name:h,description:b,productCodes:f,approverModalVisible:S,ccModalVisible:j,productCodeModalVisible:I,nameErr:D,descErr:F,approverErr:B,ccErr:H},toggleApproverModal:function(){C(!S)},toggleCcModal:function(){x(!j)},onAddApprovers:function(t){var r=[].concat(Qe(i),Qe(t));c(r),k(!0),e.onChangeApprovers(r),C(!1)},removeApprover:function(t){var r=Qe(i),n=r.findIndex((function(e){return e.user_id===t}));n<0||(r.splice(n,1),c(r),k(!0),e.onChangeApprovers(r))},onAddCcs:function(t){var r=window.appData,n=r.isYuque,a=r.me,o=n?"id":"work_id";if(t.find((function(e){return e[o]===a[o]})))m.a.error(__("不支持抄送给评审发起人"));else{var i=[].concat(Qe(u),Qe(t));s(i),k(!0),e.onChangeCcs(i),x(!1)}},removeCc:function(t){var r=Qe(u),n=r.findIndex((function(e){return e.user_id===t}));n<0||(r.splice(n,1),s(r),k(!0),e.onChangeCcs(r))},toggleProductCodeModal:function(){T(!I)},onAddProductCode:function(t){p(t),e.onChangeProductCodes(t),T(!1)},removeProductCode:function(t){var r=f.findIndex((function(e){return e.productCode===t}));if(-1!==r){var n=Qe(f);n.splice(r,1),p(n),e.onChangeProductCodes(n)}},onChangeDesc:function(t){var r=t.target.value;g(r),k(!0),e.onChangeDesc(r)},onChangeName:function(t){var r=t.target.value;y(r),k(!0),e.onChangeName(r)},resetEdit:function(){c(t?A.formatUser(t.approvers):[]),s(t?A.formatUser(t.ccs):[]),g(t?t.body:""),y(t?t.name:__("文档评审")),k(!1)}}},Ke=o.a.forwardRef((function(e,t){var r,n=e.editable,i=e.review,c=e.isMiniSize,u=n;i&&i.status!==d.STATUS.active&&(u=!1);var s=$e(e),f=s.state,p=f.approvers,m=f.ccs,v=f.description,h=f.productCodes,E=f.name,S=f.approverModalVisible,C=f.ccModalVisible,N=f.productCodeModalVisible,A=f.nameErr,I=f.descErr,T=f.approverErr,R=f.ccErr,L=window.appData,k=L.organization,P=L.isYuque;return Object(a.useImperativeHandle)(t,(function(){return{resetEdit:function(){s.resetEdit()}}})),o.a.createElement("div",{className:l()((r={},qe(r,$,!c),qe(r,Ce,c),qe(r,ae,!u),r))},o.a.createElement("div",{className:l()(Ee,K)},o.a.createElement("h6",{className:l()(ee,re)},__("评审名称")),u?o.a.createElement(o.a.Fragment,null,o.a.createElement(w.a,{className:Se,placeholder:__("请填写评审名称"),onChange:s.onChangeName,value:E}),A&&o.a.createElement("p",{className:Ue},A)):o.a.createElement("div",{className:ie},o.a.createElement("div",{"data-testid":"review-info-name"},E))),o.a.createElement("div",{className:l()(Ee,K)},o.a.createElement("h6",{className:ee},__("描述")),u?o.a.createElement(o.a.Fragment,null,o.a.createElement(w.a.TextArea,{autoSize:c?{minRows:2,maxRows:4}:{minRows:3,maxRows:6},className:Se,placeholder:__("添加评审内容说明，帮助评审人快速了解评审重点"),onChange:s.onChangeDesc,value:v}),I&&o.a.createElement("p",{className:Ue},I)):o.a.createElement("div",{className:ie},v?o.a.createElement("div",{"data-testid":"review-info-desc"},o.a.createElement(O.a,{content:v,disableHeaderBr:!0})):o.a.createElement("p",{className:ne},__("无描述信息")))),o.a.createElement("div",{className:l()(oe,K)},o.a.createElement("h6",{className:l()(ee,re)},__("评审人")),o.a.createElement("div",{className:le},p&&p.map((function(e){return o.a.createElement("div",{className:ye,key:e.id,"data-testid":"review-info-user-".concat(e.id)},o.a.createElement("a",{title:e.name,className:we},o.a.createElement(j.a,{src:e.avatar_url,size:24}),o.a.createElement("span",null,e.name),u&&o.a.createElement("a",{className:be,onClick:function(){s.removeApprover(e.user_id)}},o.a.createElement(b.default,{width:16,height:16}))))})),u&&o.a.createElement(o.a.Fragment,null,o.a.createElement("a",{className:ce,onClick:s.toggleApproverModal},o.a.createElement(g.default,null)),o.a.createElement(x.a,{type:"simple",visible:S,disableSelectors:k?["addrbook"]:[],enableDepSelect:!1,organization:k,members:p,onCancel:s.toggleApproverModal,onSubmit:s.onAddApprovers})),T&&o.a.createElement("p",{className:Ue},T))),o.a.createElement("div",{className:l()(oe,K)},o.a.createElement("h6",{className:ee},__("抄送")),o.a.createElement("div",{className:le},m&&m.map((function(e){return o.a.createElement("div",{className:ye,key:e.id,"data-testid":"review-info-user-".concat(e.id)},o.a.createElement("a",{title:e.name,className:we},o.a.createElement(j.a,{src:e.avatar_url,size:24}),o.a.createElement("span",null,e.name),u&&o.a.createElement("a",{className:be,onClick:function(){s.removeCc(e.user_id)}},o.a.createElement(b.default,{width:16,height:16}))))})),u&&o.a.createElement(o.a.Fragment,null,o.a.createElement("a",{className:ce,onClick:s.toggleCcModal},o.a.createElement(g.default,null)),o.a.createElement(x.a,{type:"simple",visible:C,disableSelectors:k?["addrbook"]:[],enableDepSelect:!1,organization:k,members:m,onCancel:s.toggleCcModal,onSubmit:s.onAddCcs})),R&&o.a.createElement("p",{className:Ue},R))),!P&&u&&o.a.createElement("div",{className:l()(Fe,K)},o.a.createElement("h6",{className:ee},__("关联产品码"),o.a.createElement(y.a,{overlayClassName:Ae,title:o.a.createElement("span",null,__("产品码是产品资产的唯一标识，详见 {productCode}",{productCode:o.a.createElement("a",{href:"https://pd.alipay.com/#/encyclopedia",target:"_blank",className:je},__("产品星球"))}))},o.a.createElement(_.default,{style:{marginLeft:8,color:"#8C8C8C"}}))),o.a.createElement("div",{className:We},h.map((function(e){return o.a.createElement("div",{key:e.productCode,className:l()(ze,qe({},He,u))},o.a.createElement(y.a,{title:__("产品名称：{name}",{name:e.productName}),placement:"top"},o.a.createElement("a",{target:"_blank",className:Ge,href:"https://pd.alipay.com/#/product/main?productCode=".concat(e.productCode),title:e.productName},e.productName)),o.a.createElement(y.a,{title:__("产品码：{code}",{code:e.productCode}),placement:"top"},o.a.createElement("span",{className:Be},e.productCode)),o.a.createElement(y.a,{title:__("产品负责人：{owner}",{owner:e.pdOwner||__("暂无")}),placement:"top"},o.a.createElement("span",{className:Ye},e.pdOwner||__("暂无"))),u&&o.a.createElement("a",{className:be,onClick:function(){s.removeProductCode(e.productCode)}},o.a.createElement(b.default,{width:16,height:16})))}))),o.a.createElement("a",{onClick:s.toggleProductCodeModal,className:ce},o.a.createElement(g.default,null)),N&&o.a.createElement(Z,{visible:N,onCancel:s.toggleProductCodeModal,onAddProductCode:s.onAddProductCode,selectedCodes:h||[]})))}));Ke.defaultProps={onError:function(){}},Ke.propTypes={review:s.a.object,editable:s.a.bool,onChangeApprovers:s.a.func,onChangeCcs:s.a.func,onChangeProductCodes:s.a.func,onChangeDesc:s.a.func,onChangeName:s.a.func,onError:s.a.func,isMiniSize:s.a.bool,doc:s.a.object};var et=Ke,tt={wrapper:"Create-module_wrapper_Jiqsh",header:"Create-module_header_kF7DM",headerTitle:"Create-module_headerTitle_KBZT5",headerReviewName:"Create-module_headerReviewName_zLDNP",headerActions:"Create-module_headerActions_GCU7X",footer:"Create-module_footer_IQYrY",btn:"Create-module_btn_KC5H4",fullBtn:"Create-module_fullBtn_jieFd",whiteBtn:"Create-module_whiteBtn_1TkFL",approveBtn:"Create-module_approveBtn_CmlKW",btnCancel:"Create-module_btnCancel_F4e8g",descInput:"Create-module_descInput_vUru2",footerNoBorder:"Create-module_footerNoBorder_CQL+E",tooltip:"Create-module_tooltip_lsslV",miniWrapper:"Create-module_miniWrapper_1npMe",reviewBtn:"Create-module_reviewBtn_+oRG+",handleWrapper:"Create-module_handleWrapper_txASJ"};function rt(e){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rt(e)}function nt(e,t,r){return t=function(e){var t=function(e,t){if("object"!==rt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==rt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===rt(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function at(){at=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,a){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),c=new N(a||[]);return n(i,"_invoke",{value:_(e,r,c)}),i}function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d={};function f(){}function p(){}function m(){}var v={};l(v,o,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(A([])));y&&y!==t&&r.call(y,o)&&(v=y);var w=m.prototype=f.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function g(e,t){function a(n,o,i,c){var l=s(e[n],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==rt(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,i,c)}),(function(e){a("throw",e,i,c)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return a("throw",e,i,c)}))}c(l.arg)}var o;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){a(e,r,t,n)}))}return o=o?o.then(n,n):n()}})}function _(e,t,r){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return j()}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var c=E(i,r);if(c){if(c===d)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=s(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var a=s(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,d;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:j}}function j(){return{value:void 0,done:!0}}return p.prototype=m,n(w,"constructor",{value:m,configurable:!0}),n(m,"constructor",{value:p,configurable:!0}),p.displayName=l(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},b(g.prototype),l(g.prototype,i,(function(){return this})),e.AsyncIterator=g,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new g(u(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},b(w),l(w,c,"Generator"),l(w,o,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=A,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function ot(e,t,r,n,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,a)}function it(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ct(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ct(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ct(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var lt=function(e){var t,r,n=it(Object(a.useState)([]),2),o=n[0],i=n[1],c=it(Object(a.useState)([]),2),l=c[0],u=c[1],s=it(Object(a.useState)(),2),d=s[0],f=s[1],p=it(Object(a.useState)(),2),y=p[0],w=p[1],b=it(Object(a.useState)(),2),g=b[0],_=b[1],E=it(Object(a.useState)(!1),2),S=E[0],C=E[1],N=it(Object(a.useState)(),2),A=N[0],j=N[1];return{state:{approvers:o,ccs:l,submitting:S,errorMsg:A},onError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;for(var r in e)if(e[r]){t=!0,j(e[r]);break}t||j()},onChangeApprovers:function(e){i(e)},onChangeCcs:function(e){u(e)},onChangeProductCodes:function(e){f(e)},onChangeDesc:function(e){w(e)},onChangeName:function(e){_(e)},onSubmit:(t=at().mark((function t(){var r,n,a,i,c,u;return at().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!S&&!A){t.next=2;break}return t.abrupt("return");case 2:return C(!0),r={target_type:e.targetType,target_id:e.target.id},void 0!==y&&(r.body=y),r.name=g||__("文档评审"),d&&(r.product_codes=d),o&&(window.appData.isYuque?(n=o.filter((function(e){return h.a.isDepartment(e)})),a=o.filter((function(e){return h.a.isUser(e)})),r.approver_ids=a.map((function(e){return e.user_id})),r.approver_department_ids=n.map((function(e){return e.id}))):r.approver_work_ids=o.map((function(e){return e.work_id}))),l&&(window.appData.isYuque?(i=l.filter((function(e){return h.a.isDepartment(e)})),c=l.filter((function(e){return h.a.isUser(e)})),r.cc_ids=c.map((function(e){return e.user_id})),r.cc_department_ids=i.map((function(e){return e.id}))):r.cc_work_ids=l.map((function(e){return e.work_id}))),t.prev=9,t.next=12,v.a.reviews.create(r);case 12:u=t.sent,C(!1),m.a.success(__("已成功发起评审")),e.onCreateReview(u),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(9),C(!1);case 21:case"end":return t.stop()}}),t,null,[[9,18]])})),r=function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(e){ot(o,n,a,i,c,"next",e)}function c(e){ot(o,n,a,i,c,"throw",e)}i(void 0)}))},function(){return r.apply(this,arguments)})}},ut=function(e){var t,r=lt(e),n=e.target,a=r.state,i=a.submitting,c=a.approvers,u=a.ccs,s=a.errorMsg,f=e.isMiniSize,m=c&&c.length>0&&c.length<=d.MAX_APPROVER_NUM,v=u&&u.length<=d.MAX_CC_NUM;return o.a.createElement("div",{className:l()("review-create-module",(t={},nt(t,tt.wrapper,!f),nt(t,tt.miniWrapper,f),t))},o.a.createElement("div",{className:tt.body},o.a.createElement(et,{target:n,onChangeApprovers:r.onChangeApprovers,onChangeCcs:r.onChangeCcs,onChangeProductCodes:r.onChangeProductCodes,onChangeDesc:r.onChangeDesc,onChangeName:r.onChangeName,onError:r.onError,isMiniSize:f,editable:!0})),o.a.createElement("div",{className:l()(tt.footer,tt.footerNoBorder)},o.a.createElement("span",null,o.a.createElement(p.a,{"data-testid":"btn-submit",className:tt.btn,type:"primary",disabled:i||!m||!v||s,onClick:r.onSubmit},__("发起评审"))),o.a.createElement(p.a,{"data-testid":"btn-cancel",className:tt.btn,onClick:e.onCancel},__("取消"))))};ut.propTypes={target:s.a.object.isRequired,targetType:s.a.oneOf(["Doc"]).isRequired,onCancel:s.a.func.isRequired,onCreateReview:s.a.func.isRequired,isMiniSize:s.a.bool,doc:s.a.object};var st=ut,dt=(r(207),r(91)),ft=r(1423),pt=r(2018),mt=(r(267),r(127)),vt=r(30),ht=r.n(vt),yt=r(213);function wt(e){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt(e)}function bt(e,t,r){return t=function(e){var t=function(e,t){if("object"!==wt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==wt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===wt(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _t(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _t(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Et=o.a.forwardRef((function(e,t){var r,n,i,c=gt(Object(a.useState)(!1),2),u=c[0],s=c[1],m=e.review,v=e.isMiniSize,h=e.isApprover,w=e.isHistoryReview,b=e.doc,g=A.formatUser(m.approvers),_=A.formatUser(m.ccs),E=m.product_codes,S=window.appData,C=S.me,N=S.defaultSpaceHost,x=g.find((function(e){return e.id===C.id}))||{},I=x.isCompleted,T=window.appData.isYuque,R=_&&_.length>0,L=!T&&E&&E.length>0,k=!window.h5,P="".concat(N,"/go/doc/").concat(b.id),D="".concat(N,"/").concat(null==m||null===(r=m.meta)||void 0===r?void 0:r.versionUrl),M=encodeURIComponent('<p>评审文档：<a href="'.concat(P,'">').concat(P,'</a></p><p>评审文档快照：<a href="').concat(D,'">').concat(D,"</a></p>")),U="https://baiyan.alipay.com/task/create?type=REQUIREMENT&name=".concat(b.title,"&lakeContent=").concat(M,"&userScope=1"),F=function(){return o.a.createElement(o.a.Fragment,null,R&&o.a.createElement("div",{className:l()(oe,K)},o.a.createElement("h6",{className:ee},__("抄送")),o.a.createElement("p",null,o.a.createElement("span",{className:ge},_&&_.map((function(e,t){return o.a.createElement("span",{className:_e,key:e.id,"data-testid":"review-info-user-".concat(e.id)},o.a.createElement(pt.a,{user:e},o.a.createElement("span",null,e.name)),o.a.createElement("span",{className:Oe},"、"))}))))),o.a.createElement("div",{className:l()(oe,K)},o.a.createElement("h6",{className:ee},__("发起时间")),o.a.createElement("p",{className:xe},ht()(m.created_at).format("YYYY-MM-DD HH:mm"))))};return o.a.createElement("div",{className:l()((n={},bt(n,$,!v),bt(n,Ce,v),n))},m.body&&o.a.createElement("div",{className:l()(oe,K)},o.a.createElement("h6",{className:l()(ee,te)},__("描述")),o.a.createElement("div",null,m.body?o.a.createElement("div",{"data-testid":"review-info-desc"},o.a.createElement(O.a,{content:m.body,disableHeaderBr:!0})):o.a.createElement("p",{className:ne},__("无描述信息")))),h&&!w&&!I&&m.status===d.STATUS.active&&o.a.createElement("div",{className:l()(oe,K)},o.a.createElement("h6",{className:l()(ee,te)},__("请投票")),o.a.createElement("div",null,o.a.createElement("div",{className:Te},o.a.createElement(p.a,{onClick:function(){return e.onSubmitApproval(d.REVIEWER_STATUS.accepted)},className:Ne},o.a.createElement("img",{src:"https://gw.alipayobjects.com/zos/bmw-prod/8a0ad84c-9110-47bc-8110-871abaeaed04.svg",width:20,style:{marginRight:2}}),__("通过")),o.a.createElement(p.a,{onClick:function(){return e.onSubmitApproval(d.REVIEWER_STATUS.rejected)},className:Ne},o.a.createElement("img",{src:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*EMY3Q7SajTMAAAAAAAAAAAAAARQnAQ",width:24}),__("不通过"))))),g&&!!g.length&&o.a.createElement("div",{className:l()(oe,K)},o.a.createElement("h6",{className:ee},__("评审人")),o.a.createElement("div",{className:le},g&&g.map((function(e){return o.a.createElement("p",{className:ue,key:e.id,"data-testid":"review-info-user-".concat(e.id)},o.a.createElement("span",{className:de},o.a.createElement(pt.a,{user:e},o.a.createElement(j.a,{src:e.avatar_url,size:28,className:ve}),o.a.createElement("span",{className:he},e.name))),o.a.createElement("span",{className:se},function(e){switch(e.reviewStatus){case d.REVIEWER_STATUS.accepted:return o.a.createElement("span",{className:pe},__("通过"));case d.REVIEWER_STATUS.rejected:return o.a.createElement("span",{className:fe},__("不通过"));case d.REVIEWER_STATUS.incomplete:default:return o.a.createElement("span",{className:me},__("未评审"))}}(e)))})))),L&&o.a.createElement("div",{className:l()(Fe,K)},o.a.createElement("h6",{className:ee},__("关联产品码")),o.a.createElement("div",{className:We},E.map((function(e){return o.a.createElement("div",{key:e.productCode,className:ze},o.a.createElement(y.a,{title:__("产品名称：{name}",{name:e.productName}),placement:"top"},o.a.createElement("a",{target:"_blank",className:Ge,href:"https://pd.alipay.com/#/product/main?productCode=".concat(e.productCode),title:e.productName},e.productName)),o.a.createElement(y.a,{title:__("产品码：{code}",{code:e.productCode}),placement:"top"},o.a.createElement("span",{className:Be},e.productCode)),o.a.createElement(y.a,{title:__("产品负责人：{owner}",{owner:e.pdOwner||__("暂无")}),placement:"top"},o.a.createElement("span",{className:Ye},e.pdOwner||__("暂无"))))})))),m.status!==d.STATUS.active&&m.meta&&m.meta.versionUrl&&o.a.createElement("div",{className:l()(oe,K)},o.a.createElement("h6",{className:ee},__("结束时间")),o.a.createElement("p",{className:xe},o.a.createElement("a",{href:"".concat(window.appData.defaultSpaceHost,"/").concat(m.meta.versionUrl),target:"_blank"},ht()(m.updated_at).format("YYYY-MM-DD HH:mm")))),k&&!window.h5&&o.a.createElement(mt.a,{placement:"topLeft",arrowPointAtCenter:!0,content:o.a.createElement("div",{className:Ie},F())},o.a.createElement("span",{className:ee},__("更多#Review"))),window.h5&&o.a.createElement("div",null,o.a.createElement("span",{className:Re,onClick:function(){return s(!u)}},u?o.a.createElement(f.b,{className:Le,name:"review-arrow-down",width:8}):o.a.createElement(f.b,{className:ke,name:"review-arrow-right",width:8}),__("更多")),u&&F()),!window.h5&&!T&&(null==m?void 0:m.status)===d.STATUS.accepted&&!w&&(null==m||null===(i=m.meta)||void 0===i?void 0:i.versionUrl)&&o.a.createElement("div",{className:Pe},o.a.createElement("a",{href:U,target:"_blank"},o.a.createElement(p.a,{className:De},__("创建白雁工作项"))),o.a.createElement("p",{className:Me},__("让需求高效执行跟进"))))}));Et.propTypes={doc:s.a.object,review:s.a.object,isMiniSize:s.a.bool,isHistoryReview:s.a.bool,isApprover:s.a.bool,onSubmitApproval:s.a.func};var St=Object(yt.b)(Object(i.d)((function(e){return{doc:e.doc}}))(Et),!0),Ct=r(1928),Nt=r.n(Ct);function At(e){var t,r,n=window.appData.locale;switch(null===(t=e.review)||void 0===t?void 0:t.status){case d.STATUS.accepted:r="accepted".concat(Nt()(n));break;case d.STATUS.rejected:r="rejected".concat(Nt()(n));break;case d.STATUS.cancelled:r="cancelled".concat(Nt()(n))}return r?o.a.createElement("div",{className:l()("reviewStamp",r)}):null}At.propTypes={review:s.a.object};var jt=At;function xt(e){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xt(e)}function Ot(e,t,r){return t=function(e){var t=function(e,t){if("object"!==xt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==xt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===xt(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function It(){It=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,a){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),c=new N(a||[]);return n(i,"_invoke",{value:_(e,r,c)}),i}function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d={};function f(){}function p(){}function m(){}var v={};l(v,o,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(A([])));y&&y!==t&&r.call(y,o)&&(v=y);var w=m.prototype=f.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function g(e,t){function a(n,o,i,c){var l=s(e[n],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==xt(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,i,c)}),(function(e){a("throw",e,i,c)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return a("throw",e,i,c)}))}c(l.arg)}var o;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){a(e,r,t,n)}))}return o=o?o.then(n,n):n()}})}function _(e,t,r){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return j()}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var c=E(i,r);if(c){if(c===d)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=s(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var a=s(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,d;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:j}}function j(){return{value:void 0,done:!0}}return p.prototype=m,n(w,"constructor",{value:m,configurable:!0}),n(m,"constructor",{value:p,configurable:!0}),p.displayName=l(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},b(g.prototype),l(g.prototype,i,(function(){return this})),e.AsyncIterator=g,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new g(u(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},b(w),l(w,c,"Generator"),l(w,o,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=A,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function Tt(e,t,r,n,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,a)}function Rt(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){Tt(o,n,a,i,c,"next",e)}function c(e){Tt(o,n,a,i,c,"throw",e)}i(void 0)}))}}function Lt(e){return function(e){if(Array.isArray(e))return Dt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Pt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||Pt(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pt(e,t){if(e){if("string"==typeof e)return Dt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Dt(e,t):void 0}}function Dt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Mt=function(e){var t,r=e.review,n=e.isMiniSize,i=e.isApprover,c=e.isHistoryReview,u=function(e){var t,r,n,i=e.review,c=kt(Object(a.useState)(i.approvers?Lt(i.approvers):[]),2),l=c[0],u=c[1],s=kt(Object(a.useState)(i.ccs?Lt(i.ccs):[]),2),f=s[0],p=s[1],y=kt(Object(a.useState)((null==i?void 0:i.product_codes)||[]),2),w=y[0],b=y[1],g=kt(Object(a.useState)(),2),_=g[0],E=g[1],S=kt(Object(a.useState)(),2),C=S[0],N=S[1],A=kt(Object(a.useState)(!1),2),j=A[0],x=A[1],O=kt(Object(a.useState)(!1),2),I=O[0],T=O[1],R=kt(Object(a.useState)(),2),L=R[0],k=R[1],P=o.a.createRef();return{state:{ccs:f,approvers:l,submitting:j,isEditing:I,errorMsg:L},infoRef:P,onError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!1;for(var r in e)if(e[r]){t=!0,k(e[r]);break}t||k()},onChangeApprovers:function(e){u(e)},onChangeCcs:function(e){p(e)},onChangeProductCodes:function(e){b(e)},onChangeDesc:function(e){E(e)},onChangeName:function(e){N(e)},startEdit:function(){T(!0)},cancelEdit:function(){T(!1),k(),P.current&&P.current.resetEdit()},finishEdit:(n=Rt(It().mark((function t(){var r,n,a,o,c,u;return It().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!j&&!L){t.next=2;break}return t.abrupt("return");case 2:return x(!0),r={id:i.id},void 0!==_&&(r.body=_),C&&(r.name=C),l&&(window.appData.isYuque?(n=l.filter((function(e){return h.a.isDepartment(e)})),a=l.filter((function(e){return h.a.isUser(e)})),r.approver_ids=a.map((function(e){return e.user_id})),r.approver_department_ids=n.map((function(e){return e.id}))):r.approver_work_ids=l.map((function(e){return e.work_id}))),f&&(window.appData.isYuque?(o=f.filter((function(e){return h.a.isDepartment(e)})),c=f.filter((function(e){return h.a.isUser(e)})),r.cc_ids=c.map((function(e){return e.user_id})),r.cc_department_ids=o.map((function(e){return e.id}))):r.cc_work_ids=f.map((function(e){return e.work_id}))),r.product_codes=w||[],t.prev=9,t.next=12,v.a.reviews.update(r);case 12:u=t.sent,x(!1),T(!1),e.updateActiveReview(u),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(9),x(!1);case 21:case"end":return t.stop()}}),t,null,[[9,18]])}))),function(){return n.apply(this,arguments)}),onSubmitApproval:(r=Rt(It().mark((function t(r){var n;return It().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!j){t.next=2;break}return t.abrupt("return");case 2:return x(!0),t.next=5,v.a.reviews.reviewTarget({id:i.id,status:r});case 5:n=t.sent,r!==d.REVIEWER_STATUS.incomplete&&m.a.success(__("已成功提交评审意见")),x(!1),e.updateActiveReview(n);case 9:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)}),onCancelReview:(t=Rt(It().mark((function t(r){var n;return It().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!j){t.next=2;break}return t.abrupt("return");case 2:return x(!0),t.next=5,v.a.reviews.cancelReview({id:i.id,status:r});case 5:n=t.sent,x(!1),e.updateActiveReview(n);case 8:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}}(e),s=u.state,f=s.submitting,w=s.isEditing,b=s.ccs,g=s.approvers,_=s.errorMsg,E=g&&g.length>0&&g.length<=d.MAX_APPROVER_NUM,S=b&&b.length<=d.MAX_CC_NUM,C=!!r.approvers.find((function(e){return e.id===r.user_id})),N=!!r.approvers.find((function(e){return e.id===r.user_id&&e.isCompleted}));return o.a.createElement("div",{className:l()((t={},Ot(t,tt.wrapper,!n),Ot(t,tt.miniWrapper,n),Ot(t,tt.miniFolding,n),t))},!w&&o.a.createElement("div",{className:tt.header},o.a.createElement("div",{className:tt.headerTitle},r.status!==d.STATUS.active?o.a.createElement("span",{className:tt.headerReviewName},r.name):o.a.createElement(o.a.Fragment,null,!C&&o.a.createElement("span",{className:tt.headerReviewName},r.name),C&&r.user&&__("{user} 邀你评审 {target}",{user:o.a.createElement(pt.a,{user:r.user},o.a.createElement("a",{href:"/".concat(r.user.login)},r.user.name)),target:o.a.createElement("span",{className:tt.headerReviewName},r.name)}),C&&r.status===d.STATUS.active&&o.a.createElement("div",{className:tt.headerActions},!w&&o.a.createElement("a",{onClick:u.startEdit},o.a.createElement(ft.default,null)," ",__("编辑")))))),o.a.createElement("div",{className:l()(tt.body,tt.stampWrapper)},w?o.a.createElement(et,{review:r,onChangeApprovers:u.onChangeApprovers,onChangeCcs:u.onChangeCcs,onChangeProductCodes:u.onChangeProductCodes,onChangeDesc:u.onChangeDesc,onChangeName:u.onChangeName,onError:u.onError,editable:w,isMiniSize:n,ref:u.infoRef,isApprover:i}):o.a.createElement(St,{isHistoryReview:c,review:r,isMiniSize:n,isApprover:i,onSubmitApproval:u.onSubmitApproval}),o.a.createElement(jt,{review:r})),!c&&r.status===d.STATUS.active&&o.a.createElement(o.a.Fragment,null,w?o.a.createElement("div",{className:l()(tt.footer,tt.footerNoBorder)},o.a.createElement(y.a,{placement:"top",title:_,className:_?tt.tooltip:{}},o.a.createElement(p.a,{onClick:u.finishEdit,disabled:f||!E||!S||_,type:"primary",className:tt.btn},__("完成"))),o.a.createElement(p.a,{onClick:u.cancelEdit,disabled:f},__("取消"))):o.a.createElement("div",{className:l()(tt.footer,tt.footerNoBorder)},C?o.a.createElement(o.a.Fragment,null,N?o.a.createElement(p.a,{disabled:f,onClick:function(){return u.onSubmitApproval(d.REVIEWER_STATUS.incomplete)},className:l()(tt.btn,tt.whiteBtn)},__("重新投票")):null):o.a.createElement(p.a,{disabled:f,type:"primary",className:tt.btn,onClick:u.startEdit},__("编辑评审")),o.a.createElement(dt.a,{title:__("确认取消评审？"),onConfirm:function(){u.onCancelReview(d.STATUS.cancelled)}},o.a.createElement(p.a,{disabled:f,className:l()(tt.btn,tt.whiteBtn)},__("取消评审"))))))};Mt.propTypes={review:s.a.object.isRequired,isMiniSize:s.a.bool,isHistoryReview:s.a.bool,updateActiveReview:s.a.func,isApprover:s.a.bool};var Ut=Mt;function Ft(e){return Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ft(e)}function Wt(e,t,r){return t=function(e){var t=function(e,t){if("object"!==Ft(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Ft(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gt(){Gt=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function u(e,t,r,a){var o=t&&t.prototype instanceof f?t:f,i=Object.create(o.prototype),c=new N(a||[]);return n(i,"_invoke",{value:_(e,r,c)}),i}function s(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d={};function f(){}function p(){}function m(){}var v={};l(v,o,(function(){return this}));var h=Object.getPrototypeOf,y=h&&h(h(A([])));y&&y!==t&&r.call(y,o)&&(v=y);var w=m.prototype=f.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function g(e,t){function a(n,o,i,c){var l=s(e[n],e,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==Ft(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,i,c)}),(function(e){a("throw",e,i,c)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return a("throw",e,i,c)}))}c(l.arg)}var o;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){a(e,r,t,n)}))}return o=o?o.then(n,n):n()}})}function _(e,t,r){var n="suspendedStart";return function(a,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw o;return j()}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var c=E(i,r);if(c){if(c===d)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=s(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function E(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var a=s(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,d;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:j}}function j(){return{value:void 0,done:!0}}return p.prototype=m,n(w,"constructor",{value:m,configurable:!0}),n(m,"constructor",{value:p,configurable:!0}),p.displayName=l(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,c,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},b(g.prototype),l(g.prototype,i,(function(){return this})),e.AsyncIterator=g,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new g(u(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},b(w),l(w,c,"Generator"),l(w,o,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=A,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return i.type="throw",i.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;C(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function Bt(e,t,r,n,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,a)}function Yt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return zt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ht=function(e){var t,r,n=e.review,o=e.updateActiveReview,i=Yt(Object(a.useState)(!1),2),c=i[0],l=i[1];return{state:{submitting:c},onSubmitApproval:(t=Gt().mark((function e(t){var r;return Gt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),e.next=3,v.a.reviews.reviewTarget({id:n.id,status:t});case 3:r=e.sent,t!==d.REVIEWER_STATUS.incomplete&&m.a.success(__("已成功提交评审意见")),l(!1),o(r);case 7:case"end":return e.stop()}}),e)})),r=function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(e){Bt(o,n,a,i,c,"next",e)}function c(e){Bt(o,n,a,i,c,"throw",e)}i(void 0)}))},function(e){return r.apply(this,arguments)})}};function Vt(e){var t,r=Ht(e),n=e.review,a=e.isApprover,i=window.appData.me,c=n.approvers.find((function(e){return e.id===i.id}))||{},u=c.isCompleted;return o.a.createElement("div",{className:l()(tt.wrapper,tt.handleWrapper,(t={},Wt(t,tt.wrapper,!window.h5),Wt(t,tt.miniWrapper,window.h5),t))},o.a.createElement("div",{className:tt.header},o.a.createElement("div",{className:tt.headerTitle},n.status!==d.STATUS.active?o.a.createElement("span",{className:tt.headerReviewName},n.name):o.a.createElement(o.a.Fragment,null,!a&&o.a.createElement("span",{className:tt.headerReviewName},n.name),a&&n.user&&n.status===d.STATUS.active&&__("{user} 邀你评审 {target}",{user:o.a.createElement(pt.a,{user:n.user},o.a.createElement("a",{href:"/".concat(n.user.login)},n.user.name)),target:o.a.createElement("span",{className:tt.headerReviewName},n.name)})))),o.a.createElement(St,{review:n,isApprover:a,onSubmitApproval:r.onSubmitApproval}),u&&a&&n.status===d.STATUS.active&&o.a.createElement("div",{className:l()(tt.footer,tt.footerNoBorder)},o.a.createElement(p.a,{disabled:r.state.submitting,onClick:function(){return r.onSubmitApproval(d.REVIEWER_STATUS.incomplete)},className:l()(tt.btn,tt.whiteBtn,tt.fullBtn)},__("重新投票"))),o.a.createElement(jt,{review:n}))}Vt.propTypes={review:s.a.object,isApprover:s.a.bool};var qt=Object(yt.b)(Vt,!0),Qt=r(126),Xt={drawer:"ReviewDrawer-module_drawer_6qnGd",header:"ReviewDrawer-module_header_NHY+y",miniHeader:"ReviewDrawer-module_miniHeader_3qcob",left:"ReviewDrawer-module_left_PAF6a",leftIconWrapper:"ReviewDrawer-module_leftIconWrapper_OuZ6c",backIcon:"ReviewDrawer-module_backIcon_fAC1b",text:"ReviewDrawer-module_text_dGN2k",right:"ReviewDrawer-module_right_f56vw",closeIcon:"ReviewDrawer-module_closeIcon_kcD+E",historyItem:"ReviewDrawer-module_historyItem_Jr41Q",card:"ReviewDrawer-module_card_Md17c",btnFold:"ReviewDrawer-module_btnFold_V2x03",btnFoldText:"ReviewDrawer-module_btnFoldText_CyWwp",isFolding:"ReviewDrawer-module_isFolding_mL2+P",isUnfolding:"ReviewDrawer-module_isUnfolding_ijwrL",h5Drawer:"ReviewDrawer-module_h5Drawer_wy-pi",historySep:"ReviewDrawer-module_historySep_7uX+R",historyIcon:"ReviewDrawer-module_historyIcon_-rCE8",foldingIcon:"ReviewDrawer-module_foldingIcon_B7TtL",btnFoldIcon:"ReviewDrawer-module_btnFoldIcon_CQTy6"};function Jt(e){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(e)}function Zt(e,t,r){return t=function(e){var t=function(e,t){if("object"!==Jt(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==Jt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Jt(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $t(e){return function(e){if(Array.isArray(e))return tr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||er(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,c=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(c.push(n.value),c.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return c}}(e,t)||er(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function er(e,t){if(e){if("string"==typeof e)return tr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tr(e,t):void 0}}function tr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var rr="create",nr="handle",ar=function(e){var t=e.me,r=e.doc,n=e.dispatch,o=Kt(Object(a.useState)(null),2),i=o[0],c=o[1],l=Kt(Object(a.useState)(!1),2),u=l[0],s=l[1],f=Kt(Object(a.useState)(!1),2),p=f[0],m=f[1],v=Kt(Object(a.useState)(!0),2),h=v[0],y=v[1],w=Kt(Object(a.useState)(e.status||nr),2),b=w[0],g=w[1],_=Kt(Object(a.useState)([]),2),E=_[0],S=_[1],C=!!(i&&i.approvers&&i.approvers.length>0)&&!!i.approvers.find((function(e){return e.id===(null==t?void 0:t.id)})),N=!!(i&&i.approvers&&i.approvers.length>0)&&!!i.approvers.find((function(e){return e.id===(null==t?void 0:t.id)&&e.isCompleted})),A=function(e){if(e){if(e.product_codes&&e.product_codes.length>0)try{e.product_codes=e.product_codes.map((function(e){return"string"==typeof e?JSON.parse(e):e}))}catch(t){e.product_codes=[]}e.name||(e.name=__("文档评审"))}},j=function(e){A(e),c(e)},x=function(e){if(e.length){var t,r=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=er(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw o}}}}(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;A(n)}}catch(e){r.e(e)}finally{r.f()}S(e)}};return{state:{activeReview:i,visible:u,disableDispatchEvent:p,isFolding:h,drawerStatus:b,historyReview:E,isApprover:C,isApproverCompleted:N},resetAll:function(e){c(null),S([]),s(!1),n({type:"review/update",payload:{latestReviewStatus:null==e?void 0:e.latestReviewStatus,showReviewDrawer:(null==e?void 0:e.latestReviewStatus)===d.STATUS.active,showCreateReviewDrawer:!1}})},setDrawerStatus:g,setVisible:s,setDisableDispatchEvent:m,onClose:function(){m(arguments.length>0&&void 0!==arguments[0]&&arguments[0]),s(!1)},onVisibleChange:function(e){var t=new CustomEvent("contentSidebarVisibleChange",{detail:{visible:e,type:"review"}});window.dispatchEvent(t)},onToggleFold:function(){return y(!h)},fetchReviews:function(){(null==r?void 0:r.latestReviewStatus)<0?s(!1):Qt.webProxy.reviews.getReviewsByTarget({target_type:"Doc",target_id:r.id}).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];g(nr);var t=e.shift();j(t),x(e),(null==t?void 0:t.status)===d.STATUS.active&&s(!0),n({type:"review/update",payload:{activeReview:t,historyReview:e}})}))},updateActiveReview:function(e){j(e);var t={activeReview:e,showReviewDrawer:!0};e.status===d.STATUS.cancelled&&(t.showCreateReviewDrawer=!1),n({type:"review/update",payload:t})},createReview:function(e){g(nr);var t=i?[i].concat($t(E)):E;j(e),S(t),n({type:"review/update",payload:{activeReview:e,historyReview:E,showReviewDrawer:!0,showCreateReviewDrawer:!1}})},cancelCreateReview:function(){i?g(nr):s(!1)}}},or=Object(a.forwardRef)((function(e,t){var r=e.me,i=e.doc,c=e.review,u=e.sidePanelManager,s=window.h5,p=ar(e),m=p.onClose,v=p.onVisibleChange,h=p.onToggleFold,y=p.fetchReviews,w=p.setDrawerStatus,b=p.setVisible,g=p.setDisableDispatchEvent,_=p.resetAll,E=p.state,S=E.activeReview,C=E.visible,N=E.disableDispatchEvent,A=E.isFolding,j=E.drawerStatus,x=E.historyReview,O=E.isApprover,I=E.isApproverCompleted;function T(e){var t=e.onLayout;return Object(a.useEffect)((function(){return t({width:305}),function(){b(!1)}}),[]),null}if(Object(a.useEffect)((function(){var e=!0,t=nr;(null==S?void 0:S.status)!==d.STATUS.active&&(e=!1),c.showReviewDrawer&&S&&(e=!0,t=nr),c.showCreateReviewDrawer&&(null==S?void 0:S.status)!==d.STATUS.active&&(e=!0,t=rr),S&&"#opendrawer"===window.location.hash&&(e=!0,t=nr,window.location.hash=""),b(e),w(t)}),[c]),Object(a.useEffect)((function(){c.activeReview&&_(i),y()}),[i.id]),Object(a.useEffect)((function(){N||v(C),g(!1),C&&(null==u||u.show("Review"))}),[C]),Object(a.useEffect)((function(){null==u||u.registerContent("Review",T)}),[]),Object(a.useImperativeHandle)(t,(function(){return{onClose:m}})),!S&&j!==rr)return null;if(window.h5&&(S.status!==d.STATUS.active||I||!O))return null;var R=function(){return x.map((function(e){return o.a.createElement("div",{className:Xt.historyItem},o.a.createElement(Ut,{isHistoryReview:!0,target:i,targetType:"Doc",review:e,isApprover:O,editable:!1,updateActiveReview:p.updateActiveReview,isMiniSize:s}))}))},L=o.a.createElement("div",{className:l()(Xt.header,Zt({},Xt.miniHeader,s))},o.a.createElement("div",{className:Xt.left},c.isFromTab?o.a.createElement("div",{className:Xt.leftIconWrapper,onClick:function(){null==u||u.show("MoreFeature")}},o.a.createElement(f.b,{name:"arrow-left",className:Xt.backIcon})):null,o.a.createElement("span",{className:Xt.text},j===rr?__("发起评审"):__("评审"))),o.a.createElement("div",{className:Xt.right,onClick:function(){m(!1),null==u||u.hide()}},o.a.createElement(f.b,{name:"close",className:Xt.closeIcon})));return o.a.createElement(n.a,{title:L,closable:!1,placement:s?"bottom":"right",mask:s,zIndex:1e3,visible:C,className:l()(Xt.drawer,Zt({},Xt.h5Drawer,s)),width:306},o.a.createElement("div",{className:Xt.wrapper},S&&j===nr&&o.a.createElement(o.a.Fragment,null,S.user_id===(null==r?void 0:r.id)?o.a.createElement("div",{className:Xt.reviewInfo,id:"active-review","data-testid":"active-review"},o.a.createElement(Ut,{target:i,targetType:"Doc",review:S,isApprover:O,editable:i.abilities.update,updateActiveReview:p.updateActiveReview,isMiniSize:s})):o.a.createElement("div",{id:"reviewForm"},o.a.createElement(qt,{review:S,isApprover:O,updateActiveReview:p.updateActiveReview})),!!x.length&&o.a.createElement(o.a.Fragment,null,window.h5?o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:Xt.historySep},__("历史评审")),o.a.createElement("div",null,R())):o.a.createElement(o.a.Fragment,null,o.a.createElement("a",{className:Xt.btnFold,onClick:h},A?o.a.createElement(f.b,{className:l()(Xt.btnFoldIcon,Xt.iconRight),name:"review-arrow-right",width:16}):o.a.createElement(f.b,{className:l()(Xt.btnFoldIcon,Xt.iconDown),name:"review-arrow-down",width:16}),o.a.createElement("span",{className:Xt.btnFoldText},__("历史评审"))),o.a.createElement("div",{className:A?Xt.isFolding:Xt.isUnfolding},R())))),j===rr&&o.a.createElement("div",{className:Xt.reviewInfo},o.a.createElement(st,{target:i,targetType:"Doc",onCreateReview:p.createReview,onCancel:p.cancelCreateReview,isMiniSize:s}))))}));or.propTypes={doc:s.a.object,me:s.a.object,dispatch:s.a.func,review:s.a.object,sidePanelManager:s.a.object};t.default=Object(i.d)((function(e){return{me:e.me,dispatch:e.dispatch,review:e.review,doc:e.doc}}),null,null,{forwardRef:!0})(or)}}]);