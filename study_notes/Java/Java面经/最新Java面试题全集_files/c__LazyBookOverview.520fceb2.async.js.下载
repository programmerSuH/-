/*! For license information please see c__LazyBookOverview.520fceb2.async.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{1788:function(t,e,r){var n=r(385).getInterest,o=r(118).INTEREST_CODE;t.exports=function(){return n().interests[o.open_ocr]}},1810:function(t,e,r){"use strict";var n=r(108);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(i=n.key,a=void 0,a=function(t,e){if("object"!==o(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"),"symbol"===o(a)?a:String(a)),n)}var i,a}var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,o,a;return e=t,o=[{key:"previewImages",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t&&t.length){var o=window.appData,i=o.isAlipayApp,a=o.isDingTalkMiniApp,c=o.isYuqueMobileApp,u=(0,r(243).getImageBrowser)();i?window.AlipayJSBridge.call("imageViewer",{images:t.map((function(t){return{u:t.src,t:t.msrc}})),init:e},(function(r){r.success||u.open(t,e)})):a?window.dd.postMessage({name:"previewImage",params:{urls:t.map((function(t){return t.src})),current:e}}):c?n.a.previewImage({images:t.map((function(t){return{url:t.src,thumbnailUrl:t.msrc,width:t.w,height:t.h}})),index:e}):u.open(t,e)}}}],o&&i(e.prototype,o),a&&i(e,a),Object.defineProperty(e,"prototype",{writable:!1}),t}(),c=new a;e.a=c},2504:function(t,e,r){"use strict";r(3161);var n=r(2508);r(2813);e.a=n.a},2686:function(t,e,r){"use strict";var n=r(84),o=r.n(n),i={_bookGrayscaleConfig:null,getDefaultDocumentFormat:function(t,e,r){return e=e||"",r=r||{},o.a.DOC_DEFAULT_FORMAT[t]||o.a.FORMAT.LAKE}};e.a=i},2699:function(t,e,r){"use strict";r.d(e,"b",(function(){return a})),r.d(e,"a",(function(){return u}));var n=r(1735),o=r.n(n),i=(r(30),r(174));function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.search;return e&&o.a.parse(e)[t]||""}var c=window.self!==window.top;function u(){var t=a("mode"),e=i.a.get("topicsPageMode");return"clean"===t?(i.a.set("topicsPageMode","clean"),"clean"):"normal"===t?(i.a.remove("topicsPageMode"),"normal"):e&&"clean"===e&&c?"clean":"normal"}},306:function(t,e,r){"use strict";r(2594);var n=r(262);r(529);e.a=n.a},3458:function(t,e,r){"use strict";var n=r(0),o=r.n(n),i=r(107),a=r.n(i),c=r(233),u=r.n(c),l=r(84),f=r.n(l),s=r(2853),p=r.n(s),y=r(3484),d=r(616),v=r(111),b=r(3481),h=r.n(b),m=r(3482),g=r.n(m),w=r(1788),O=r.n(w),_=r(3483),k=r(431),j=r(165),P=r(174),E=r(38);function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function T(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==S(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===S(i)?i:String(i)),n)}var o,i}var x,C=a()("editor:cache"),B=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.key=e}var e,r,n;return e=t,(r=[{key:"retrieve",value:function(){var t={format:null,value:null};C("[retrieve]key: ",this.key);var e=P.a.get(this.key);if(!e)return null;C("[retrieve]find text: ",e);var r=p.a.guessFormat(e);return t.format=r,t.value=e,C("[retrieve]doc: ",t),t}},{key:"put",value:function(t,e){C("[put]content cached: ","".concat(this.key," -> ").concat(t)),P.a.set(this.key,t)}},{key:"clear",value:function(){P.a.remove(this.key)}}])&&T(e.prototype,r),n&&T(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function R(t){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(t)}function A(t){return function(t){if(Array.isArray(t))return N(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return N(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return N(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function D(){D=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),c=new P(o||[]);return n(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function p(){}function y(){}function d(){}var v={};u(v,i,(function(){return this}));var b=Object.getPrototypeOf,h=b&&b(b(E([])));h&&h!==e&&r.call(h,i)&&(v=h);var m=d.prototype=p.prototype=Object.create(v);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==R(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function O(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return S()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function _(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function E(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return y.prototype=d,n(m,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:y,configurable:!0}),y.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),u(m,c,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=E,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:E(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function L(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function F(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){L(i,n,o,a,c,"next",t)}function c(t){L(i,n,o,a,c,"throw",t)}a(void 0)}))}}function I(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,M(n.key),n)}}function U(t,e,r){return(e=M(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function M(t){var e=function(t,e){if("object"!==R(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==R(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===R(e)?e:String(e)}var G=a()("biz:lakex_mini_editor_base"),V=(null===(x=window.appData)||void 0===x?void 0:x.me)||{},z=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),U(this,"getDefaultSuggestions",(function(){return e.options.getDefaultSuggestions?e.options.getDefaultSuggestions():[]})),U(this,"setEngine",(function(t){e._engine=t})),U(this,"getEngine",(function(){return e._engine})),U(this,"setValue",(function(t){var r=t;t?t.startsWith("<")?(r={type:"lake",value:t},e._engine.setDocument(r)):"string"==typeof t&&(r={type:"json",value:JSON.parse(t)},e._engine.setDocument(r)):e._engine.setDocument()})),U(this,"getValue",(function(){return e._engine?e._engine.getPureContent():e.getDefaultValue()})),U(this,"isEmpty",(function(){return!e._engine||e._engine.isEmpty()})),U(this,"getSafetyValue",F(D().mark((function t(){return D().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.contentReady();case 2:return t.abrupt("return",e.getValue());case 3:case"end":return t.stop()}}),t)})))),U(this,"getHtml",(function(){return e._engine?e._engine.getPureHtml():null})),U(this,"focus",(function(t){if(!e._engine)return null;e._engine.focus(t)})),U(this,"contentReady",F(D().mark((function t(){var r,n;return D().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._engine){t.next=2;break}return t.abrupt("return",null);case 2:return r=0,n=function t(n,o){e._engine.canGetDocument()?n():r>10?o():(r++,setTimeout((function(){t(n,o)}),1e3))},t.abrupt("return",new Promise(n));case 5:case"end":return t.stop()}}),t)})))),U(this,"saveAll",(function(){if(!e.options.disableCache){var t={format:f.a.FORMAT.LAKE,value:e.getValue(),html:e.getHtml()};e.saveToCache(t)}})),this.options=r,this.from=r.from||"reply",this.targetType=r.targetType,this.belong=r.belong,this.belongType=r.belongType,this.group=r.group,this.target=r.target,this.attachType=r.attachType,this.isEditMode=!!r.target,this.type=this.getType(),this.ctoken=Object(k.a)(window);var n=this.getCacheKey();this.cacheKeys={title:"".concat(n,"/title"),content:"".concat(n,"/content")},this.editorCache=new B(this.cacheKeys.content),this.uuid=this.getUuid(),this._engine=null,this.initialDocument=null,this.init()}var e,r,n;return e=t,r=[{key:"init",value:function(){this.initialDocument=this.getInitialDocument(),G("init use: ",this.initialDocument)}},{key:"buildOptions",value:function(t){var e={supportTranslate:g()(),supportImgOCR:O()(),hideEmbedButton:h()(),hideVipIcon:Object(_.a)(),board:{boardWebProxyParams:{webProxy:E.a,userId:null==V?void 0:V.id,spm:v,appData:window.appData}},image:{uploadFileURL:this.getImageUploadUrl(),accept:Object(d.getImageAcceptArr)()},file:{uploadFileURL:this.getFileUploadUrl(),accept:Object(d.getFileAcceptArr)(),localdocAccept:Object(d.getLocalDocAcceptArr)(),embedButtonStatus:Object(d.getIsDiabledPreviewAndEmbed)()},transfer:{transferFilesURL:this.getTransferUrl()},localdoc:{uploadFileURL:this.getFileUploadUrl(),accept:Object(d.getLocalDocAcceptArr)()},mention:{mentionURL:j.a.patchGroupIdToUrl(this.getMentionActionUrl()),defaultList:this.getDefaultSuggestions()},lockedtext:{action:this.getCryptoUrl()},placeholder:(null==t?void 0:t.placeholder)||this.getPlaceholder(),link:{autoCompleteLink:null==t?void 0:t.autoCompleteLink},video:{uploadAction:this.getMediaUploadUrl("video"),queryAction:"/api/video",accept:Object(d.getVideoAcceptArr)()},audio:{uploadFileURL:this.getMediaUploadUrl("audio"),queryURL:"/api/video",accept:Object(d.getAudioAcceptArr)()},vote:{allowVote:!0,queryDetailUrl:"api/votes",queryCheckUrl:"api/votes/mine",voteUrl:"api/votes"},yuque:{disableEmbedView:this.getDisableYuqueCardEmbedView()},materialLibrary:{component:o.a.createElement(y.a,{storage:P.a,webProxy:E.a})},fullscreen:{enable:this.getEnableFullEditor()}},r=[],n=this.getBlockedCards();return n&&n.length>1&&(r=Array.from(new Set([].concat(A(r),A(n))))),e.disabledPlugins=r,e}},{key:"getProps",value:function(){return{format:this.getFormat(),defaultValue:this.getDefaultValue(),autoFocus:this.getAutoFocus(),isMiniSize:this.isMiniSize()}}},{key:"getType",value:function(){return this.options.type||"unknown"}},{key:"getAutoFocus",value:function(){var t=this.options.autoFocus;return null!=t?t:!!this.options.useMiniGuide}},{key:"isMiniSize",value:function(){return!1}},{key:"getEnableFullEditor",value:function(){return!0}},{key:"getBlockedCards",value:function(){return["video","checkIn","vote","audio","premium"]}},{key:"getUuid",value:function(){var t=this.cacheKeys.uuid,e=P.a.get(t);return e||(e=u()(32)+u()(32),P.a.set(t,e)),e}},{key:"getDefaultFormat",value:function(){return f.a.FORMAT.LAKE}},{key:"getFormat",value:function(){var t=this.options.format;return t||this.initialDocument.format}},{key:"getPlaceholder",value:function(){return this.options.placeholder}},{key:"getInitialDocument",value:function(){if(this.initialDocument)return this.initialDocument;var t=this.loadFromCache();if(G("cached document:",t),this.isEditMode){var e=this.getContentObject();return G("adapted content: ",e),t&&(G("merge with cached content",t),e.format=t.format||e.format,e.title=t.title||e.title,e.value=t.value||e.value),e}if(t)return t.format=t.format||this.getDefaultFormat(),t;var r=this.loadFromUrl();return r||{format:this.getDefaultFormat(),title:null,value:null}}},{key:"getContentObject",value:function(t){return{format:(t=t||this.target||{}).format||this.getDefaultFormat(),title:t.title||t.name||"",value:t.value||t.body_asl||t.content}}},{key:"getDefaultValue",value:function(){var t=this.options.defaultValue;return t||this.initialDocument.value}},{key:"getFullUrl",value:function(t){return this.isEditMode&&!this.options.useBelongAttach?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.target.id,"&from=").concat(this.from):this.belong?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.belong.id,"&from=").concat(this.from):null}},{key:"getTransferUrl",value:function(){var t="/api/upload/copy?type=attachment",e=this.getFullUrl(t);return e||(e="".concat(t,"&attachable_uuid=").concat(this.uuid,"&from=").concat(this.from)),e}},{key:"getFileUploadUrl",value:function(){var t="/api/upload/attach?ctoken=".concat(this.ctoken,"&type=attachment");return this.getFullUrl(t)}},{key:"getMediaUploadUrl",value:function(t){var e="/api/video?ctoken=".concat(this.ctoken,"&format=").concat(t);return this.getFullUrl(e)}},{key:"getImageUploadUrl",value:function(){var t=this.getFileUploadUrl();return t?t.replace("&type=attachment","&type=image"):null}},{key:"getMentionActionUrl",value:function(){var t="";return this.isEditMode&&!this.options.useBelongAttach?t="/api/users/complete?target_type=".concat(this.attachType,"&target_id=").concat(this.target.id):this.belong&&(t="/api/users/complete?target_type=".concat(this.attachType,"&target_id=").concat(this.belong.id)),t}},{key:"getCryptoUrl",value:function(){return"/api/services/crypto"}},{key:"getDisableYuqueCardEmbedView",value:function(){return this.options.disableYuqueCardEmbedView}},{key:"saveToCache",value:function(t){G("save to cache:",t),t.format&&(t.title&&P.a.set(this.cacheKeys.title,t.title),this.needCacheContent(t)?this.editorCache.put(t.value,t.format):G("value is empty or the same as origin, ignore cache"))}},{key:"needCacheContent",value:function(t){if(!t.value)return!1;if(p.a.isBlank(t))return this.editorCache.clear(),!1;if(!this.target)return!0;var e=this.getContentObject();return!p.a.isContentSame(t.format,e.value,t.value)}},{key:"reset",value:function(){G("reset editor"),this.clearCache(),this._engine&&this._engine.setDocument()}},{key:"isContentChanged",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!t){var e=this.loadFromCache();e&&(t=e.value)}if(!this.target)return!0;var r="<cursor />";return this.target.body_asl.trim().replace(r,"")!==t.trim().replace(r,"")}},{key:"clearCache",value:function(){var t=this;G("clear cache"),Object.keys(this.cacheKeys).forEach((function(e){P.a.remove(t.cacheKeys[e])}))}},{key:"getCacheKey",value:function(){return this.isEditMode&&this.target&&this.belong?"autosave/".concat(this.type,"/").concat(this.belong.id,"/").concat(this.target.id,"/edit"):this.belong?"autosave/".concat(this.type,"/").concat(this.belong.id,"/new"):"autosave/".concat(this.type)}},{key:"loadFromUrl",value:function(){}},{key:"loadFromCache",value:function(){var t=!1,e={format:null,title:null,value:null},r=this.editorCache.retrieve();if(r&&(t=!0,e.format=r.format,e.value=r.value),this.cacheKeys.title){var n=P.a.get(this.cacheKeys.title);n&&(t=!0,e.title=n)}return t?e:null}}],n=[{key:"getEmptyDocument",value:function(){return{format:f.a.FORMAT.LAKE,value:null}}}],r&&I(e.prototype,r),n&&I(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.a=z},3471:function(t,e,r){"use strict";var n=r(34);function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(i=n.key,a=void 0,a=function(t,e){if("object"!==o(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(i,"string"),"symbol"===o(a)?a:String(a)),n)}var i,a}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},a.apply(this,arguments)}function c(t,e){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},c(t,e)}function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=l(t);if(e){var i=l(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}var f=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&c(t,e)}(s,t);var e,r,o,f=u(s);function s(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),f.apply(this,arguments)}return e=s,(r=[{key:"buildOptions",value:function(t){var e=a(l(s.prototype),"buildOptions",this).call(this,t);return e.disabledPlugins.push("mobile"),n.ua.mobile&&e.disabledPlugins.push("placeholder","slash"),e}},{key:"getBlockedCards",value:function(){return["video","audio","premium","checkIn"]}}])&&i(e.prototype,r),o&&i(e,o),Object.defineProperty(e,"prototype",{writable:!1}),s}(r(3458).a);e.a=f},3540:function(t,e,r){"use strict";r.d(e,"c",(function(){return y})),r.d(e,"a",(function(){return w})),r.d(e,"l",(function(){return T})),r.d(e,"j",(function(){return J})),r.d(e,"h",(function(){return rt})),r.d(e,"i",(function(){return lt})),r.d(e,"k",(function(){return bt})),r.d(e,"f",(function(){return _t})),r.d(e,"d",(function(){return Tt})),r.d(e,"e",(function(){return Nt})),r.d(e,"g",(function(){return Gt})),r.d(e,"b",(function(){return Wt}));var n=r(84),o=r.n(n),i=r(2686),a=r(3458);function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==c(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===c(i)?i:String(i)),n)}var o,i}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=s(t);if(e){var o=s(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===c(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}var p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}(c,t);var e,r,n,a=f(c);function c(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),a.apply(this,arguments)}return e=c,n=[{key:"getEmptyDocument",value:function(){return{format:o.a.FORMAT.LAKE,value:null}}}],(r=[{key:"getType",value:function(){var t=this.options.targetType;return t?"".concat(t,"_comment").toLowerCase():"comment"}},{key:"getCacheKey",value:function(){var t=this.options.replyId;return this.isEditMode&&this.target&&this.belong?"autosave/".concat(this.type,"/").concat(this.belong.id,"/").concat(this.target.id,"/edit"):this.belong?"autosave/".concat(this.type,"/").concat(this.belong.id,"/").concat(t,"/new"):"autosave/".concat(this.type)}},{key:"isMiniSize",value:function(){return this.options.useMiniGuide||this.options.isMiniSize||window.h5}},{key:"getDefaultFormat",value:function(){return i.a.getDefaultDocumentFormat(o.a.TYPE.TOPIC)}},{key:"getEnableFullEditor",value:function(){return"Artboard"!==this.targetType}}])&&u(e.prototype,r),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(a.a),y=p;function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function v(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==d(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===d(i)?i:String(i)),n)}var o,i}function b(t,e){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},b(t,e)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=m(t);if(e){var o=m(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function m(t){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},m(t)}var g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&b(t,e)}(i,t);var e,r,n,o=h(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="Resource",t.useBelongAttach=!0,t.from="reply",o.call(this,t)}return e=i,(r=[{key:"getType",value:function(){return"area_comment"}},{key:"getAutoFocus",value:function(){return!0}},{key:"isMiniSize",value:function(){return!0}}])&&v(e.prototype,r),n&&v(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(y),w=g;function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function _(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==O(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===O(i)?i:String(i)),n)}var o,i}function k(){return k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=E(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},k.apply(this,arguments)}function j(t,e){return j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},j(t,e)}function P(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=E(t);if(e){var o=E(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===O(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function E(t){return E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},E(t)}var S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&j(t,e)}(i,t);var e,r,n,o=P(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="Doc",t.useBelongAttach=!0,t.from="reply",o.call(this,t)}return e=i,(r=[{key:"buildOptions",value:function(t){var e,r=k(E(i.prototype),"buildOptions",this).call(this,t);return r.image.showMiniToolbarWhen="never",null===(e=r.disabledPlugins)||void 0===e||e.push("slash"),r}},{key:"getType",value:function(){return"word_comment"}},{key:"getAutoFocus",value:function(){return!1}},{key:"isMiniSize",value:function(){return!0}},{key:"getEnableFullEditor",value:function(){return!1}}])&&_(e.prototype,r),n&&_(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(y),T=S,x=r(2699),C=r(174),B=r(3471);function R(t){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R(t)}function A(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==R(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==R(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===R(i)?i:String(i)),n)}var o,i}function N(t,e){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},N(t,e)}function D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=L(t);if(e){var o=L(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===R(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function L(t){return L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},L(t)}B.a;var F=r(30),I=r.n(F);function U(t){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U(t)}function M(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function G(t,e,r){return(e=z(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function V(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,z(n.key),n)}}function z(t){var e=function(t,e){if("object"!==U(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==U(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===U(e)?e:String(e)}function H(t,e){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},H(t,e)}function K(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Y(t);if(e){var o=Y(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===U(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function Y(t){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Y(t)}var q={daily:{title:"#prefix# #day# 日报汇总",content:'<!doctype lake><meta name="doc-version" content="1" /><p>建议 TL 每天组织日会，将一天的重点事项安排于此</p><p>每位同学下班前，在此提交日报</p><p><br /></p><p>日报不要记流水账，尽量在 200 字以内</p><p>重点项目或工作要及时总结和提报，尤其风险点要及时提报</p><p>可以写写思考和感想</p><p><br /></p><p>写完自己的日报，也看看大家的</p><p>每一位同学的努力，都值得认真阅读与交流</p><p><br /></p><p><span style="color: #FA541C;"><span>注意不要提及保密项目和敏感数据</span></span></p>'},weekly:{title:"#prefix# #day# 周报汇总",content:'<!doctype lake><meta name="doc-version" content="1" /><p>将一周的工作总结回复于此</p><p><br /></p><p>不要记流水账，尽量在 800 字以内</p><p>重点项目或工作要及时总结和提报，尤其风险点要及时提报</p><p>可以写写思考和感想</p><p><br /></p><p>写完自己的周报，也看看大家的</p><p>每一位同学的努力，都值得认真阅读与交流</p><p><br /></p><p><span style="color: #FA541C;"><span>注意不要提及保密项目和敏感数据</span></span></p>'},vote:{title:"一起来投票吧",content:'<!doctype lake><meta name="doc-version" content="1" /><card type="block" name="vote" value="data:%7B%22margin%22%3Atrue%2C%22id%22%3A%22jTHWG%22%2C%22type%22%3A%22single%22%7D"></card><p><br /><cursor /></p>'},default:{title:"",content:"<!doctype lake><p></p>"}},W=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&H(t,e)}(i,t);var e,r,n,o=K(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),o.apply(this,arguments)}return e=i,n=[{key:"getTemplate",value:function(t,e){var r=q[t];if(!r)return{title:null,content:null};var n=I()(new Date).format("YYYY-MM-DD"),o=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?M(Object(r),!0).forEach((function(e){G(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},r);return o.title=o.title.replace("#prefix#",e),o.title=o.title.replace("#day#",n),o}}],(r=[{key:"getType",value:function(){return"thread"}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete?target_type=Group&target_id=".concat(this.group.id)}},{key:"getFileUploadUrl",value:function(){var t="/api/upload/attach?ctoken=".concat(this.ctoken,"&type=attachment");return this.isEditMode?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.target.id,"&from=").concat(this.from):this.belong?"".concat(t,"&attachable_type=").concat(this.belongType||"Book","&attachable_id=").concat(this.belong.id,"&from=").concat(this.from):this.group?"".concat(t,"&attachable_type=User&attachable_id=").concat(this.group.id,"&from=").concat(this.from):null}},{key:"getFileCopyUrl",value:function(){var t="/api/upload/copy?type=attachment";return this.isEditMode?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.target.id,"&from=").concat(this.from):"".concat(t,"&attachable_uuid=").concat(this.uuid,"&from=").concat(this.from)}}])&&V(e.prototype,r),n&&V(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(B.a),J=W;function Q(t){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q(t)}function Z(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==Q(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Q(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===Q(i)?i:String(i)),n)}var o,i}function $(t,e){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$(t,e)}function X(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=tt(t);if(e){var o=tt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===Q(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function tt(t){return tt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},tt(t)}var et=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$(t,e)}(i,t);var e,r,n,o=X(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),o.apply(this,arguments)}return e=i,(r=[{key:"getType",value:function(){return"thread_board"}},{key:"getAutoFocus",value:function(){return!0}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete?target_type=Group&target_id=".concat(this.group.id)}},{key:"getFileUploadUrl",value:function(){var t="/api/upload/attach?ctoken=".concat(this.ctoken,"&type=attachment");return this.isEditMode&&!this.options.useBelongAttach?"".concat(t,"&attachable_type=").concat(this.attachType,"&attachable_id=").concat(this.target.id,"&from=").concat(this.from):this.belong?"".concat(t,"&attachable_type=").concat(this.belongType,"&attachable_id=").concat(this.belong.id,"&from=").concat(this.from):null}}])&&Z(e.prototype,r),n&&Z(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a),rt=et;function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}function ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==nt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===nt(i)?i:String(i)),n)}var o,i}function it(t,e){return it=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},it(t,e)}function at(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ct(t);if(e){var o=ct(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===nt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function ct(t){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ct(t)}var ut=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&it(t,e)}(i,t);var e,r,n,o=at(i);function i(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),o.apply(this,arguments)}return e=i,(r=[{key:"getType",value:function(){return"thread_comment"}}])&&ot(e.prototype,r),n&&ot(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(y),lt=ut;function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function st(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==ft(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===ft(i)?i:String(i)),n)}var o,i}function pt(){return pt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=vt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},pt.apply(this,arguments)}function yt(t,e){return yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yt(t,e)}function dt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=vt(t);if(e){var o=vt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===ft(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function vt(t){return vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vt(t)}var bt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yt(t,e)}(i,t);var e,r,n,o=dt(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="User",t.useBelongAttach=!0,o.call(this,t)}return e=i,(r=[{key:"buildOptions",value:function(t){var e=pt(vt(i.prototype),"buildOptions",this).call(this,t);return e.typography={mustTypography:"classic",typography:"classic",paragraphSpacing:"default"},e}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"isMiniSize",value:function(){return this.options.small}},{key:"getAutoFocus",value:function(){return!0}}])&&st(e.prototype,r),n&&st(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a);function ht(t){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ht(t)}function mt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==ht(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==ht(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===ht(i)?i:String(i)),n)}var o,i}function gt(t,e){return gt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gt(t,e)}function wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ot(t);if(e){var o=Ot(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===ht(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function Ot(t){return Ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ot(t)}var _t=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gt(t,e)}(i,t);var e,r,n,o=wt(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.from="group_custom",t.attachType="User",t.useBelongAttach=!0,o.call(this,t)}return e=i,(r=[{key:"getType",value:function(){return"group_custom"}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete?target_type=Group&target_id=".concat(this.group.id)}},{key:"isMiniSize",value:function(){return this.options.small}},{key:"getAutoFocus",value:function(){return!0}}])&&mt(e.prototype,r),n&&mt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a);function kt(t){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(t)}function jt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==kt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==kt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===kt(i)?i:String(i)),n)}var o,i}function Pt(t,e){return Pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pt(t,e)}function Et(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=St(t);if(e){var o=St(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===kt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function St(t){return St=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},St(t)}var Tt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pt(t,e)}(i,t);var e,r,n,o=Et(i);function i(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var e=t.feedback;return t.attachType="User",t.useBelongAttach=!0,t.from="feedback",t.placeholder={tip:e&&e.abilities.manage?"你将要代表语雀回复用户，请使用官方口吻，慎重填写":"",emptyParagraphTip:""},o.call(this,t)}return e=i,(r=[{key:"getType",value:function(){return"feedback_comment"}},{key:"getCacheKey",value:function(){var t=this.getType();if(this.target)return"autosave/".concat(t,"/").concat(this.target.id,"/edit");var e=this.options.feedback;return e?"autosave/".concat(t,"/").concat(e.id,"/new"):"autosave/".concat(t)}},{key:"getContentObject",value:function(){var t=this.target.content||{source:"",format:"lake"};return{format:t.format,value:t.source||""}}},{key:"isMiniSize",value:function(){return!0}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"getAutoFocus",value:function(){return!0}}])&&jt(e.prototype,r),n&&jt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(B.a);function xt(t){return xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xt(t)}function Ct(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==xt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==xt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===xt(i)?i:String(i)),n)}var o,i}function Bt(t,e){return Bt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Bt(t,e)}function Rt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=At(t);if(e){var o=At(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===xt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function At(t){return At=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},At(t)}var Nt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Bt(t,e)}(i,t);var e,r,n,o=Rt(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="User",t.useBelongAttach=!0,t.placeholder={tip:"",emptyParagraphTip:""},t.from="feedback",o.call(this,t)}return e=i,(r=[{key:"getType",value:function(){return"feedback_remark"}},{key:"getContentObject",value:function(){return{format:"lake",value:this.target.remark||""}}},{key:"getCacheKey",value:function(){return this.target?"autosave/".concat(this.type,"/").concat(this.target.id):"autosave/".concat(this.type)}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"getAutoFocus",value:function(){return!0}},{key:"isMiniSize",value:function(){return!0}}])&&Ct(e.prototype,r),n&&Ct(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(B.a);function Dt(t){return Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dt(t)}function Lt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==Dt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Dt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===Dt(i)?i:String(i)),n)}var o,i}function Ft(){return Ft="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Mt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Ft.apply(this,arguments)}function It(t,e){return It=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},It(t,e)}function Ut(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Mt(t);if(e){var o=Mt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===Dt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function Mt(t){return Mt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Mt(t)}var Gt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&It(t,e)}(i,t);var e,r,n,o=Ut(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.target&&(t.attachType="Doclet"),o.call(this,t)}return e=i,(r=[{key:"getCards",value:function(){return this.options.target?Ft(Mt(i.prototype),"getCards",this).call(this):["label"]}},{key:"getFullCards",value:function(){return this.options.target?Ft(Mt(i.prototype),"getFullCards",this).call(this):["label"]}},{key:"getAutoFocus",value:function(){return!0}},{key:"getMentionActionUrl",value:function(){return"/api/users/complete"}},{key:"isMiniSize",value:function(){return!1}}])&&Lt(e.prototype,r),n&&Lt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a);function Vt(t){return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vt(t)}function zt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,i=void 0,i=function(t,e){if("object"!==Vt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==Vt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===Vt(i)?i:String(i)),n)}var o,i}function Ht(){return Ht="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=qt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Ht.apply(this,arguments)}function Kt(t,e){return Kt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Kt(t,e)}function Yt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=qt(t);if(e){var o=qt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(t,e){if(e&&("object"===Vt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function qt(t){return qt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},qt(t)}var Wt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Kt(t,e)}(i,t);var e,r,n,o=Yt(i);function i(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t.attachType="Doclet",o.call(this,t)}return e=i,(r=[{key:"buildOptions",value:function(t){var e=Ht(qt(i.prototype),"buildOptions",this).call(this,t);return e.typography={typography:"classic",paragraphSpacing:"relax"},e}},{key:"isMiniSize",value:function(){return this.options.small}},{key:"getAutoFocus",value:function(){return!0}}])&&zt(e.prototype,r),n&&zt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),i}(a.a)},355:function(t,e,r){var n=r(370),o=r(186),i=r(221),a=r(79),c=r(155),u=r(220),l=r(230),f=r(276),s="[object Map]",p="[object Set]",y=Object.prototype.hasOwnProperty;t.exports=function(t){if(null==t)return!0;if(c(t)&&(a(t)||"string"==typeof t||"function"==typeof t.splice||u(t)||f(t)||i(t)))return!t.length;var e=o(t);if(e==s||e==p)return!t.size;if(l(t))return!n(t).length;for(var r in t)if(y.call(t,r))return!1;return!0}},4528:function(t,e,r){},4640:function(t,e,r){"use strict";var n,o;r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return o})),function(t){t.Toc="toc",t.CreatedAt="created_at",t.UpdatedAt="updated_at"}(n||(n={})),function(t){t.Book="Book",t.Card="Card",t.Column="Column",t.Custom="Custom"}(o||(o={}))},4641:function(t,e,r){"use strict";e.a={containerWrapper:"BookOverview-module_containerWrapper_DgnNE",upload:"BookOverview-module_upload_oDqT-",container:"BookOverview-module_container_1XOeO",bookHead:"BookOverview-module_bookHead_+4tu8",bookTitle:"BookOverview-module_bookTitle_dJHa-",bookIcon:"BookOverview-module_bookIcon_wlbhc",editable:"BookOverview-module_editable_qciTg",bookName:"BookOverview-module_bookName_+UPrt",action:"BookOverview-module_action_Syxj1",bookAction:"BookOverview-module_bookAction_ROIf-",bookActionItem:"BookOverview-module_bookActionItem_sbPH8",needSave:"BookOverview-module_needSave_pVuxm",update:"BookOverview-module_update_HbybS",star:"BookOverview-module_star_uvjUk",share:"BookOverview-module_share_gT2zn",statistics:"BookOverview-module_statistics_uHBns",docCount:"BookOverview-module_docCount_rTm77",wordCount:"BookOverview-module_wordCount_-Mcic",count:"BookOverview-module_count_4RxbQ",bookContributor:"BookOverview-module_bookContributor_yQxOn",editor:"BookOverview-module_editor_T56aC",viewer:"BookOverview-module_viewer_wHZhn",none:"BookOverview-module_none_Ec8cF",togglePanel:"BookOverview-module_togglePanel_mPWOh",title:"BookOverview-module_title_ok4h8",desc:"BookOverview-module_desc_mHhnV",toggleItem:"BookOverview-module_toggleItem_c4bNf",catalogHeaderTitle:"BookOverview-module_catalogHeaderTitle_6yl+P",tocContainer:"BookOverview-module_tocContainer_GR86Z",headerSwitch:"BookOverview-module_headerSwitch_xlCUf",switchBtnBg:"BookOverview-module_switchBtnBg_Gj+Gg",treeSelected:"BookOverview-module_treeSelected_tqaat",cardSelected:"BookOverview-module_cardSelected_S9EbS",columnSelected:"BookOverview-module_columnSelected_5Qn-T",switchButtons:"BookOverview-module_switchButtons_tH51-",switchBtn:"BookOverview-module_switchBtn_IVGhh",switchIcon:"BookOverview-module_switchIcon_5iInw",switchBtnSelected:"BookOverview-module_switchBtnSelected_IfORb",catalogModule:"BookOverview-module_catalogModule_xPRJ4",catalogMoreIcon:"BookOverview-module_catalogMoreIcon_tV7z9",empty:"BookOverview-module_empty_CmmT6",mt_26:"BookOverview-module_mt_26_iuvqB",selectPanel:"BookOverview-module_selectPanel_iQlU8",selectTitle:"BookOverview-module_selectTitle_nHGBR",selectItem:"BookOverview-module_selectItem_kWvPj",divider:"BookOverview-module_divider_FyGF3"}},4642:function(t,e,r){"use strict";r(1991);var n=r(671);r(4528);e.a=n.a},5062:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return ot}));r(4528);var n=r(4642),o=(r(2813),r(2504)),i=(r(113),r(35)),a=(r(1707),r(144)),c=(r(197),r(36)),u=(r(267),r(127)),l=(r(529),r(306)),f=(r(64),r(21)),s=(r(61),r(23)),p=(r(388),r(133)),y=r(0),d=r.n(y),v=r(555),b=r(3657),h=r(593),m=r(1541),g=r(1531),w=r(1526),O=r(1539),_=r(815),k=r(13),j=r.n(k),P=r(5063),E=r.n(P),S=r(126),T=r(174),x=r(109),C=r(360),B=r(18),R=r(447),A=r(42),N=r(3540),D=r(4640),L=r(4641);function F(t){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F(t)}function I(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function U(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?I(Object(r),!0).forEach((function(e){K(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function M(){M=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),c=new P(o||[]);return n(a,"_invoke",{value:O(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var s={};function p(){}function y(){}function d(){}var v={};u(v,i,(function(){return this}));var b=Object.getPrototypeOf,h=b&&b(b(E([])));h&&h!==e&&r.call(h,i)&&(v=h);var m=d.prototype=p.prototype=Object.create(v);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function o(n,i,a,c){var u=f(t[n],t,i);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==F(s)&&r.call(s,"__await")?e.resolve(s.__await).then((function(t){o("next",t,a,c)}),(function(t){o("throw",t,a,c)})):e.resolve(s).then((function(t){l.value=t,a(l)}),(function(t){return o("throw",t,a,c)}))}c(u.arg)}var i;n(this,"_invoke",{value:function(t,r){function n(){return new e((function(e,n){o(t,r,e,n)}))}return i=i?i.then(n,n):n()}})}function O(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return S()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=_(a,r);if(c){if(c===s)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=f(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===s)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function _(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),s;var o=f(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,s;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,s):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,s)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function E(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:S}}function S(){return{value:void 0,done:!0}}return y.prototype=d,n(m,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:y,configurable:!0}),y.displayName=u(d,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,c,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(w.prototype),u(w.prototype,a,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(l(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),u(m,c,"Generator"),u(m,i,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=E,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,s):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),s},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),s}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;j(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:E(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),s}},t}function G(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function V(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){G(i,n,o,a,c,"next",t)}function c(t){G(i,n,o,a,c,"throw",t)}a(void 0)}))}}function z(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return H(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function K(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==F(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===F(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Y=Object(R.b)((function(){return Promise.resolve().then(r.bind(null,4489))}),{suspense:!0}),q=Object(R.b)((function(){return Promise.all([r.e(1),r.e(6),r.e(130)]).then(r.bind(null,5067))}),{suspense:!0}),W=Object(R.b)((function(){return r.e(126).then(r.bind(null,3813))}),{suspense:!0}),J=Object(R.b)((function(){return r.e(127).then(r.bind(null,3784))}),{suspense:!0}),Q=Object(R.b)((function(){return Promise.all([r.e(0),r.e(1),r.e(9),r.e(29),r.e(146)]).then(r.bind(null,3699)).then((function(t){return t.ShareButton}))}),{suspense:!0}),Z=Object(R.b)((function(){return Promise.all([r.e(0),r.e(1),r.e(4),r.e(5),r.e(136)]).then(r.bind(null,3542))}),{suspense:!0}),$=Object(R.b)((function(){return Promise.all([r.e(0),r.e(1),r.e(4),r.e(10),r.e(137)]).then(r.bind(null,1816))}),{suspense:!0}),X=Object(R.b)((function(){return Promise.all([r.e(0),r.e(1),r.e(5),r.e(6),r.e(128)]).then(r.bind(null,5064))}),{suspense:!0}),tt=function(t){var e=t.sections;return d.a.createElement("div",{className:L.a.selectPanel},e.map((function(t,r){return d.a.createElement("div",{key:r},e.length>1&&r>0&&r<e.length&&d.a.createElement(p.a,{className:L.a.divider}),d.a.createElement("div",{className:L.a.selectSection},t.title&&d.a.createElement("div",{className:L.a.selectTitle},t.title),t.content))})))},et=function(t){var e=t.order,r=t.onChangeOrder;return d.a.createElement(tt,{sections:[{title:__("排序"),content:d.a.createElement("div",{className:L.a.selectList},[{name:__("按目录顺序"),value:D.b.Toc},{name:__("按创建时间"),value:D.b.CreatedAt},{name:__("按更新时间"),value:D.b.UpdatedAt}].map((function(t){return d.a.createElement("div",{className:L.a.selectItem,onClick:function(){return r(t.value)},key:t.value},d.a.createElement("span",null,t.name),e===t.value&&d.a.createElement(h.default,null))})))}]})},rt=function(t){var e,r=t.layout,n=t.maxLevel,o=t.displayValue,i=t.onChangeLevel,a=t.tailType,c=t.onChangeTailType,u=t.onChangeOrder,l=t.order;return(e={},K(e,D.a.Book,d.a.createElement(tt,{sections:[{title:__("默认展示"),content:d.a.createElement("div",{className:L.a.selectList},[{name:__("全部层级"),value:"all"}].concat(Array.from({length:n},(function(t,e){return{name:__("第 {level} 级",{level:e+1}),value:e.toString()}}))).map((function(t){return d.a.createElement("div",{className:L.a.selectItem,onClick:function(){return i(t.value)},key:t.value},d.a.createElement("span",null,t.name),o===t.value&&d.a.createElement(h.default,null))})))},{title:__("显示"),content:d.a.createElement("div",{className:L.a.selectList},[{name:__("创建时间"),value:x.TOC_TAIL_TYPES.CREATED_AT},{name:__("更新时间"),value:x.TOC_TAIL_TYPES.UPDATED_AT},{name:__("作者"),value:x.TOC_TAIL_TYPES.AUTHOR},{name:__("文档路径"),value:x.TOC_TAIL_TYPES.SLUG}].map((function(t){return d.a.createElement("div",{className:L.a.selectItem,onClick:function(){return c(t.value)},key:t.value},d.a.createElement("span",null,t.name),a===t.value&&d.a.createElement(h.default,null))})))}]})),K(e,D.a.Card,d.a.createElement(et,{order:l,onChangeOrder:u})),K(e,D.a.Column,d.a.createElement(et,{order:l,onChangeOrder:u})),e)[r]},nt=function(t){var e=t.enable,r=t.editable,n=t.editComponent,o=t.viewComponent,i=t.className;if(!e)return null;var a=r?n:o;return d.a.createElement("div",{className:i},a)};function ot(){var t,e,r,p,h,k,P,x=Object(v.e)(),R=Object(v.f)((function(t){return{book:t.book,me:t.me,group:t.group}})),F=R.book,I=R.me,G=R.group,H=Object(y.useRef)(null),tt=Object(y.useRef)(null),et="bookOverview/doclet/".concat(F.id),ot=z(Object(y.useState)(!0),2),it=ot[0],at=ot[1],ct=z(Object(y.useState)(!0),2),ut=ct[0],lt=ct[1],ft=z(Object(y.useState)(!1),2),st=ft[0],pt=ft[1],yt=z(Object(y.useState)(null),2),dt=yt[0],vt=yt[1],bt=z(Object(y.useState)(""),2),ht=bt[0],mt=bt[1],gt=z(Object(y.useState)(!1),2),wt=gt[0],Ot=gt[1],_t=z(Object(y.useState)(D.a.Book),2),kt=_t[0],jt=_t[1],Pt=z(Object(y.useState)(!1),2),Et=Pt[0],St=Pt[1],Tt=z(Object(y.useState)(!1),2),xt=Tt[0],Ct=Tt[1],Bt=z(Object(y.useState)(!1),2),Rt=Bt[0],At=Bt[1],Nt=z(Object(y.useState)({wordCount:0,enableCustomBody:!0,enableCatalog:!0,order:D.b.Toc}),2),Dt=Nt[0],Lt=Nt[1],Ft=Dt.wordCount,It=Dt.enableCustomBody,Ut=Dt.enableCatalog,Mt=Dt.order,Gt=z(Object(y.useState)([]),2),Vt=Gt[0],zt=Gt[1],Ht={order:Mt,book:F,inTocDocs:Vt,catalogLoading:ut,layout:kt,group:G,isEdit:wt};Object(y.useEffect)((function(){V(M().mark((function t(){var e,r,n,o,i,a,c,u,l,f;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.webProxy.books.getOverviewInfo({id:F.id});case 2:return e=t.sent,r=e.wordCount,n=e.contributors,o=e.enableCustomBody,i=e.enableCatalog,a=e.layout,c=e.customIndex,u=e.order,l=e.enableUserFeed,window.appData.enableUserFeed=l,Lt({wordCount:r,enableCustomBody:o,enableCatalog:i,order:u}),a===D.a.Custom?jt(D.a.Book):jt(a),vt(c),mt(c.body_asl),H.current=new N.b({defaultValue:c.body_asl,target:c}),x({type:"book/update",payload:{contributors:n}}),a===D.a.Book&&(at(!1),lt(!1)),t.next=21,S.webProxy.docs.find({book_id:F.id});case 21:f=t.sent,x({type:"book/update",payload:{docs:f}}),zt(te(f.filter((function(t){return!Object(C.isDocNotInToc)(t,F.toc)})).filter(Boolean),u)),at(!1),lt(!1);case 26:case"end":return t.stop()}}),t)})))()}),[]),Object(y.useEffect)((function(){V(M().mark((function t(){var e,r;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=null,!I.id){t.next=6;break}return t.next=4,S.webProxy.mine.marks.findOne({target_type:"Book",id:F.id});case 4:r=t.sent,e=r.markAction;case 6:x({type:"book/update",payload:{mark:e}});case 7:case"end":return t.stop()}}),t)})))()}),[]);var Kt=Object(y.useMemo)((function(){var t,e=F.catalog_display_level||10,r=1;return null===(t=F.toc)||void 0===t||t.forEach((function(t){r=Math.max(r,t.level)})),r<2&&(r=Math.max(r,2)),"all"!==e&&(r=Math.max(e,r)),r}),[F.toc,F.catalog_display_level]),Yt=function(){var t=V(M().mark((function t(){var e;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=H&&H.current){t.next=2;break}return t.abrupt("return");case 2:T.a.set(et,null==H||null===(e=H.current)||void 0===e?void 0:e.getValue()),Ct(!0);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),qt=function(){var t=V(M().mark((function t(){var e,r;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(dt){t.next=2;break}return t.abrupt("return");case 2:if(T.a.remove(et),H.current){t.next=5;break}return t.abrupt("return");case 5:if((e=H.current.getValue())!==ht){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,S.webProxy.doclets.updateContent({id:null==dt?void 0:dt.id,body_asl:e,format:"lake",draft_version:null==dt?void 0:dt.draft_version});case 10:return t.next=12,S.webProxy.doclets.publish({id:dt.id});case 12:return t.next=14,S.webProxy.doclets.findOne({id:dt.id});case 14:r=t.sent,mt(r.body_asl),vt(r),H.current=new N.b({defaultValue:r.body_asl,target:r});case 18:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Wt=function(){var t=V(M().mark((function t(){var e,r;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=H&&H.current){t.next=2;break}return t.abrupt("return");case 2:e=T.a.get(et),r=e||ht,H.current.setValue(r);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Jt=function(){var t=V(M().mark((function t(){return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,qt().finally((function(){Ot(!1),Ct(!1)}));case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Qt=function(){var t=V(M().mark((function t(e){var r;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.webProxy.books.update({id:F.id,cover:e});case 2:return At(!1),t.next=5,S.webProxy.books.findOne({id:F.id,find_by_id:!0});case 5:r=t.sent,x({type:"book/update",payload:{cover:r.cover}});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Zt=function(){var t=V(M().mark((function t(e){return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return x({type:"book/updateSettingProps",payload:{book_icon:e}}),t.next=3,S.webProxy.books.update({id:F.id,book_icon:e});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),$t=function(){var t=V(M().mark((function t(e){return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return St(!1),x({type:"book/update",payload:U(U({},F),{},{catalog_display_level:e})}),t.next=4,S.webProxy.catalogNodes.updateSettings({book_id:F.id,catalog_display_level:e});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Xt=function(){var t=V(M().mark((function t(e){return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return St(!1),x({type:"book/update",payload:U(U({},F),{},{catalog_tail_type:e})}),t.next=4,S.webProxy.catalogNodes.updateSettings({book_id:F.id,catalog_tail_type:e});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),te=function(t,e){if(D.b.Toc===e){var r,n=E()(t.map((function(t){return[t.id,t]})));return null===(r=F.toc)||void 0===r?void 0:r.filter((function(t){return"DOC"===t.type})).map((function(t){return n[t.doc_id]})).filter(Boolean)}return D.b.CreatedAt===e?t.sort((function(t,e){return new Date(e.created_at).getTime()-new Date(t.created_at).getTime()})):D.b.UpdatedAt===e?t.sort((function(t,e){return new Date(e.content_updated_at).getTime()-new Date(t.content_updated_at).getTime()})):[]},ee=function(){var t=V(M().mark((function t(e){return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return St(!1),Lt(U(U({},Dt),{},{order:e})),zt(te(Vt,e)),t.next=5,S.webProxy.books.updateSettings({id:F.id,order:e});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),re=function(){var t=V(M().mark((function t(e){return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Lt(U(U({},Dt),{},{enableCustomBody:e})),t.next=3,S.webProxy.books.updateSettings({id:F.id,enable_custom_body:e});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ne=function(){var t=V(M().mark((function t(e){return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Lt(U(U({},Dt),{},{enableCatalog:e})),t.next=3,S.webProxy.books.updateSettings({id:F.id,enable_catalog:e});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),oe=function(){var t=V(M().mark((function t(e){return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return jt(e),t.next=3,S.webProxy.books.updateSettings({id:F.id,layout:e});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ie=function(){var t=V(M().mark((function t(e){var r;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.webProxy.books.update(e,{ignoreGlobalMessage:!0});case 2:r=t.sent,x({type:"book/update",payload:{public:r.public,password:r.password,indexed_level:r.indexed_level,privacy_migrated:r.privacy_migrated}}),Object.keys(e).includes("public")&&(r.public===B.PRIVACY.private?s.a.success(__("已关闭分享知识库里的所有内容")):s.a.success(__("已对知识库里所有内容生效")));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return d.a.createElement("div",{className:L.a.containerWrapper},wt&&d.a.createElement("div",{className:L.a.upload,onClick:function(){return At(!0)}},d.a.createElement("span",null,__("替换背景"))),d.a.createElement("div",{className:L.a.container},d.a.createElement(a.a,{avatar:{shape:"square",size:36},title:{width:200},paragraph:{rows:2},active:!0,loading:it},d.a.createElement("div",{className:L.a.bookHead},d.a.createElement("div",{className:L.a.bookTitle},d.a.createElement(b.a,{className:j()(L.a.bookIcon,K({},L.a.editable,wt)),value:F.book_icon,updateIcon:Zt,width:38,height:46,disabled:!wt}),d.a.createElement("span",{className:L.a.bookName},F.name)),d.a.createElement("div",{className:L.a.action},d.a.createElement("div",{className:L.a.bookAction},!wt&&d.a.createElement(J,{className:j()(L.a.bookActionItem,L.a.star),iconSize:16,book:F}),((null===(t=F.abilities)||void 0===t?void 0:t.share)||(null===(e=F.abilities)||void 0===e?void 0:e.create_collaborator))&&!wt&&d.a.createElement(d.a.Fragment,null,d.a.createElement(Q,{shareViewType:"BOOK",key:"share-book-".concat(F.id),targetResource:F,onChangeShare:ie,organization:window.appData.organization,book:F,group:G,me:I,canShare:null===(r=F.abilities)||void 0===r?void 0:r.share,canCollaborator:null===(p=F.abilities)||void 0===p?void 0:p.create_collaborator},d.a.createElement(f.a,{className:j()(L.a.bookActionItem,L.a.share)},d.a.createElement("span",null,__("分享"))))),wt&&d.a.createElement(u.a,{trigger:"click",placement:"bottomRight",content:d.a.createElement("div",{className:L.a.togglePanel},d.a.createElement("div",{className:L.a.title},__("页面设置")),d.a.createElement("p",{className:L.a.desc},__("选择是否显示以下模块，打开即为显示")),d.a.createElement("div",{className:L.a.toggleItem},d.a.createElement("span",null,__("自定义模块")),d.a.createElement(l.a,{checked:It,onChange:re})),d.a.createElement("div",{className:L.a.toggleItem},d.a.createElement("span",null,__("目录模块")),d.a.createElement(l.a,{checked:Ut,onChange:ne})))},d.a.createElement("div",{className:j()(L.a.bookActionItem,L.a.setting)},d.a.createElement(m.default,{width:18,height:18}))),(null===(h=F.abilities)||void 0===h?void 0:h.create_doc)&&!wt&&d.a.createElement(Y,{book:F,group:G,placement:"bottomRight",className:L.a.bookActionItem,prepend:(null===(k=F.abilities)||void 0===k?void 0:k.modify_setting)&&d.a.createElement(c.a.Item,{key:"edit",className:L.a.menuItem,onClick:function(){return Ot(!0)},icon:d.a.createElement(A.b,{width:16,name:"edit-border"})},__("编辑首页"))}),wt&&d.a.createElement("div",{className:j()(L.a.bookActionItem,L.a.update,xt?L.a.needSave:""),onClick:Jt},__("更新"))))),d.a.createElement("div",{className:L.a.statistics},d.a.createElement("span",{className:L.a.docCount},d.a.createElement("b",{className:L.a.count},Vt.length||0)," ",__("文档")),d.a.createElement("span",{className:L.a.wordCount},d.a.createElement("b",{className:L.a.count},Ft)," ",__("字"))),d.a.createElement(W,{className:L.a.bookContributor,users:F.contributors,canEdit:F.abilities.modify_setting&&wt,bookId:F.id})),d.a.createElement(nt,{editable:(null==H?void 0:H.current)&&wt,enable:It,editComponent:d.a.createElement("div",{className:L.a.editor},d.a.createElement(Z,{editor:H.current,tplDoc:{type:"repoHomePage"},placeholder:{tip:__("直接输入正文，也可选择一个模板："),emptyParagraphTip:__("输入 / 唤起更多")},needCreateGuide:!0,onChange:Yt,onSubmit:qt,onLoad:Wt})),viewComponent:d.a.createElement(a.a,{className:L.a.viewer,title:!1,paragraph:{rows:3},active:!0,loading:it},d.a.createElement("div",{className:j()(L.a.viewer,K({},L.a.none,st))},d.a.createElement($,{forwardedRef:tt,content:ht,genOutline:!1,genAnchor:!1,simpleUI:!0,onReady:function(){var t,e,r;wt&&pt(null==H||null===(r=H.current)||void 0===r?void 0:r.isEmpty());pt((null==tt||null===(t=tt.current)||void 0===t||null===(e=t.viewer)||void 0===e?void 0:e.queryCommandValue("isEmpty"))||!1)}})))}),d.a.createElement(nt,{className:L.a.catalogModule,editable:wt,enable:Ut,editComponent:d.a.createElement(d.a.Fragment,null,d.a.createElement("div",{className:L.a.headerSwitch},d.a.createElement("div",{className:j()(L.a.switchBtnBg,(P={},K(P,L.a.treeSelected,kt===D.a.Book),K(P,L.a.cardSelected,kt===D.a.Card),K(P,L.a.columnSelected,kt===D.a.Column),P))}),d.a.createElement("div",{className:L.a.switchButtons},d.a.createElement(i.a,{placement:"bottom",title:__("目录视图")},d.a.createElement("div",{className:j()(L.a.switchBtn,K({},L.a.switchBtnSelected,kt===D.a.Book)),onClick:function(){return oe(D.a.Book)}},d.a.createElement(g.default,{className:L.a.switchIcon}))),d.a.createElement(i.a,{placement:"bottom",title:__("卡片视图")},d.a.createElement("div",{className:j()(L.a.switchBtn,K({},L.a.switchBtnSelected,kt===D.a.Card)),onClick:function(){return oe(D.a.Card)}},d.a.createElement(w.default,{className:L.a.switchIcon}))),d.a.createElement(i.a,{placement:"bottom",title:__("专栏视图")},d.a.createElement("div",{className:j()(L.a.switchBtn,K({},L.a.switchBtnSelected,kt===D.a.Column)),onClick:function(){return oe(D.a.Column)}},d.a.createElement(O.default,{className:L.a.switchIcon}))))),d.a.createElement(u.a,{trigger:"click",placement:"bottomRight",visible:Et,onVisibleChange:function(t){return St(t)},content:d.a.createElement(rt,{layout:kt,maxLevel:Kt,displayValue:F.catalog_display_level,onChangeLevel:$t,tailType:F.catalog_tail_type,onChangeTailType:Xt,order:Mt,onChangeOrder:ee})},d.a.createElement("div",{className:L.a.catalogMoreIcon,onClick:function(){return St(!0)}},d.a.createElement(_.default,{width:16,height:16})," "))),viewComponent:d.a.createElement("div",{className:L.a.catalogHeaderTitle})}),d.a.createElement(nt,{enable:Ut,viewComponent:d.a.createElement(X,Ht)}),wt||It||Ut?null:d.a.createElement(n.a,{className:L.a.empty,image:"https://gw.alipayobjects.com/mdn/prod_resou/afts/img/A*wPMVTriBo40AAAAAAAAAAAAAARQnAQ",description:d.a.createElement(o.a,null,__("暂无内容"))})),Rt&&d.a.createElement(q,{cover:F.cover,bookId:F.id,visible:Rt,onCancel:function(){return At(!1)},onSubmit:Qt}))}},5063:function(t,e){t.exports=function(t){for(var e=-1,r=null==t?0:t.length,n={};++e<r;){var o=t[e];n[o[0]]=o[1]}return n}}}]);